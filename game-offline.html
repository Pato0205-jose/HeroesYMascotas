<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Héroes y Mascotas - Juego Offline</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: rgba(255,255,255,0.9);
            color: #667eea;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
        }

        .nav-button:hover, .nav-button.active {
            background: #667eea;
            color: white;
        }

        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
        }

        .pet-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Panel Pou simplificado */
        .pou-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .pou-pet {
            text-align: center;
        }

        .pou-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
        }

        .pou-stats {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stat-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            border-radius: 10px;
        }

        .health-fill {
            background: #28a745;
        }

        .happiness-fill {
            background: #ffc107;
        }

        .hunger-fill {
            background: #dc3545;
        }

        .pou-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .action-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
        }

        .action-btn:hover {
            background: #5a6fd8;
        }

        .action-btn.feed {
            background: #28a745;
        }

        .action-btn.play {
            background: #ffc107;
            color: #333;
        }

        .action-btn.walk {
            background: #17a2b8;
        }

        .action-btn.heal {
            background: #dc3545;
        }

        .action-btn.revive {
            background: #6f42c1;
        }

        @media (max-width: 768px) {
            .pou-container {
                grid-template-columns: 1fr;
            }
            
            .nav-menu {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> Héroes y Mascotas</h1>
            <p>¡Juego Offline - Funciona sin Internet!</p>
        </div>

        <!-- Panel de Login -->
        <div class="panel" id="login-panel">
            <h2><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</h2>
            <div id="login-status"></div>
            
            <div class="form-group">
                <label for="username">Usuario:</label>
                <input type="text" id="username" placeholder="Tu nombre de usuario">
            </div>
            <div class="form-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" placeholder="Tu contraseña">
            </div>
            <button class="btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
            </button>
            <button class="btn btn-success" onclick="showRegister()">
                <i class="fas fa-user-plus"></i> Registrarse
            </button>
            <button class="btn" onclick="createSampleData()" style="background: #6f42c1; margin-top: 10px;">
                <i class="fas fa-magic"></i> Crear Datos de Ejemplo
            </button>
        </div>

        <!-- Panel de Registro -->
        <div class="panel hidden" id="register-panel">
            <h2><i class="fas fa-user-plus"></i> Registrarse</h2>
            <div id="register-status"></div>
            
            <div class="form-group">
                <label for="reg-username">Usuario:</label>
                <input type="text" id="reg-username" placeholder="Nombre de usuario">
            </div>
            <div class="form-group">
                <label for="reg-password">Contraseña:</label>
                <input type="password" id="reg-password" placeholder="Contraseña">
            </div>
            <div class="form-group">
                <label for="reg-name">Nombre del Héroe:</label>
                <input type="text" id="reg-name" placeholder="Nombre real del héroe">
            </div>
            <div class="form-group">
                <label for="reg-alias">Alias:</label>
                <input type="text" id="reg-alias" placeholder="Alias del héroe">
            </div>
            <button class="btn btn-success" onclick="register()">
                <i class="fas fa-user-plus"></i> Registrarse
            </button>
            <button class="btn" onclick="showLogin()">
                <i class="fas fa-arrow-left"></i> Volver al Login
            </button>
        </div>

        <!-- Panel Principal del Juego -->
        <div class="panel hidden" id="game-panel">
            <h2><i class="fas fa-gamepad"></i> Panel Principal</h2>
            <div id="game-status"></div>
            
            <!-- Menú de Navegación -->
            <div class="nav-menu">
                <button class="nav-button active" onclick="showSection('heroes')">
                    <i class="fas fa-users"></i> Héroes
                </button>
                <button class="nav-button" onclick="showSection('pets')">
                    <i class="fas fa-paw"></i> Mascotas
                </button>
                <button class="nav-button" onclick="showSection('adoptions')">
                    <i class="fas fa-heart"></i> Adopciones
                </button>
                <button class="nav-button" onclick="showSection('virtual-pets')">
                    <i class="fas fa-robot"></i> Mascotas Virtuales
                </button>
                <button class="nav-button btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
                <button class="nav-button btn-danger" onclick="resetGame()" style="background: #fd7e14;">
                    <i class="fas fa-trash"></i> Reiniciar Juego
                </button>
            </div>

            <!-- Sección de Héroes -->
            <div id="heroes-section">
                <h3><i class="fas fa-users"></i> Gestión de Héroes</h3>
                <div id="heroes-status"></div>
                
                <div class="form-group">
                    <label for="hero-name">Nombre:</label>
                    <input type="text" id="hero-name" placeholder="Nombre del héroe">
                </div>
                <div class="form-group">
                    <label for="hero-alias">Alias:</label>
                    <input type="text" id="hero-alias" placeholder="Alias del héroe">
                </div>
                <div class="form-group">
                    <label for="hero-city">Ciudad:</label>
                    <input type="text" id="hero-city" placeholder="Ciudad del héroe">
                </div>
                <div class="form-group">
                    <label for="hero-team">Equipo:</label>
                    <input type="text" id="hero-team" placeholder="Equipo del héroe">
                </div>
                <button class="btn" onclick="createHero()">
                    <i class="fas fa-plus"></i> Crear Héroe
                </button>
                <button class="btn btn-success" onclick="loadHeroes()">
                    <i class="fas fa-list"></i> Ver Todos
                </button>
                
                <div id="heroes-list"></div>
            </div>

            <!-- Sección de Mascotas -->
            <div id="pets-section" class="hidden">
                <h3><i class="fas fa-paw"></i> Gestión de Mascotas</h3>
                <div id="pets-status"></div>
                
                <div class="form-group">
                    <label for="pet-name">Nombre:</label>
                    <input type="text" id="pet-name" placeholder="Nombre de la mascota">
                </div>
                <div class="form-group">
                    <label for="pet-type">Tipo:</label>
                    <select id="pet-type">
                        <option value="">Selecciona un tipo</option>
                        <option value="Perro">Perro</option>
                        <option value="Gato">Gato</option>
                        <option value="Ave">Ave</option>
                        <option value="Reptil">Reptil</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pet-power">Poder:</label>
                    <input type="text" id="pet-power" placeholder="Poder de la mascota">
                </div>
                <button class="btn" onclick="createPet()">
                    <i class="fas fa-plus"></i> Crear Mascota
                </button>
                <button class="btn btn-success" onclick="loadPets()">
                    <i class="fas fa-list"></i> Ver Todas
                </button>
                
                <div id="pets-list"></div>
            </div>

            <!-- Sección de Adopciones -->
            <div id="adoptions-section" class="hidden">
                <h3><i class="fas fa-heart"></i> Adopciones</h3>
                <div id="adoptions-status"></div>
                
                <div class="form-group">
                    <label for="adopt-pet-id">ID de la Mascota:</label>
                    <input type="number" id="adopt-pet-id" placeholder="ID de la mascota a adoptar">
                </div>
                <button class="btn btn-success" onclick="adoptPet()">
                    <i class="fas fa-heart"></i> Adoptar Mascota
                </button>
                <button class="btn btn-success" onclick="loadMyAdoptions()">
                    <i class="fas fa-list"></i> Ver Mis Adopciones
                </button>
                
                <div id="adoptions-list"></div>
            </div>

            <!-- Sección de Mascotas Virtuales -->
            <div id="virtual-pets-section" class="hidden">
                <h3><i class="fas fa-robot"></i> Mascotas Virtuales</h3>
                <div id="virtual-pets-status"></div>
                
                <div class="form-group">
                    <label for="virtual-pet-id">ID de la Mascota Adoptada:</label>
                    <input type="number" id="virtual-pet-id" placeholder="ID de la mascota adoptada">
                </div>
                <button class="btn" onclick="createVirtualPet()">
                    <i class="fas fa-plus"></i> Crear Mascota Virtual
                </button>
                <button class="btn btn-success" onclick="loadVirtualPets()">
                    <i class="fas fa-list"></i> Ver Mascotas Virtuales
                </button>
                
                <div id="virtual-pets-list"></div>
            </div>

            <!-- Panel de Mascota Virtual Individual (Estilo Pou) -->
            <div id="pou-panel" class="hidden">
                <h3><i class="fas fa-robot"></i> Mi Mascota Virtual</h3>
                <div id="pou-status"></div>
                
                <div class="pou-container">
                    <!-- Lado izquierdo: Mascota y estadísticas -->
                    <div class="pou-pet">
                        <div class="pou-avatar" id="pou-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h4 id="pou-name">Cargando...</h4>
                        
                        <div class="pou-stats">
                            <h5><i class="fas fa-heartbeat"></i> Salud</h5>
                            <div class="stat-bar">
                                <div class="stat-fill health-fill" id="health-bar" style="width: 0%"></div>
                            </div>
                            <span id="health-value">0</span>/100
                            
                            <h5><i class="fas fa-smile"></i> Felicidad</h5>
                            <div class="stat-bar">
                                <div class="stat-fill happiness-fill" id="happiness-bar" style="width: 0%"></div>
                            </div>
                            <span id="happiness-value">0</span>/100
                            
                            <h5><i class="fas fa-utensils"></i> Hambre</h5>
                            <div class="stat-bar">
                                <div class="stat-fill hunger-fill" id="hunger-bar" style="width: 0%"></div>
                            </div>
                            <span id="hunger-value">0</span>/100
                            
                            <h5><i class="fas fa-info-circle"></i> Estado</h5>
                            <div id="pet-status">Cargando...</div>
                        </div>
                    </div>
                    
                    <!-- Lado derecho: Acciones -->
                    <div>
                        <div class="pou-actions">
                            <button class="action-btn feed" onclick="feedPet()">
                                <i class="fas fa-utensils"></i> Alimentar
                            </button>
                            <button class="action-btn play" onclick="playWithPet()">
                                <i class="fas fa-dice"></i> Jugar
                            </button>
                            <button class="action-btn walk" onclick="walkPet()">
                                <i class="fas fa-walking"></i> Pasear
                            </button>
                            <button class="action-btn heal" onclick="healPet()">
                                <i class="fas fa-first-aid"></i> Curar
                            </button>
                            <button class="action-btn revive" onclick="revivePet()">
                                <i class="fas fa-heart"></i> Revivir
                            </button>
                        </div>
                        
                        <div class="card">
                            <h5><i class="fas fa-history"></i> Última Actividad</h5>
                            <div id="last-activity">Ninguna actividad realizada</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="backToVirtualPets()">
                    <i class="fas fa-arrow-left"></i> Volver a Mascotas Virtuales
                </button>
            </div>
        </div>
    </div>

    <script>
        // Datos almacenados localmente
        let heroes = [];
        let pets = [];
        let adoptions = [];
        let virtualPets = [];
        let currentHeroId = null;
        let currentHero = null;
        let currentVirtualPet = null;
        let currentVirtualPetId = null;
        let nextHeroId = 1;
        let nextPetId = 1;
        let nextVirtualPetId = 1;

        // Cargar datos guardados
        function loadSavedData() {
            heroes = JSON.parse(localStorage.getItem('heroes') || '[]');
            pets = JSON.parse(localStorage.getItem('pets') || '[]');
            adoptions = JSON.parse(localStorage.getItem('adoptions') || '[]');
            virtualPets = JSON.parse(localStorage.getItem('virtualPets') || '[]');
            
            // Si no hay datos, crear algunos de ejemplo
            if (heroes.length === 0) {
                createSampleData();
            }
            
            if (heroes.length > 0) {
                nextHeroId = Math.max(...heroes.map(h => h.id)) + 1;
            }
            if (pets.length > 0) {
                nextPetId = Math.max(...pets.map(p => p.id)) + 1;
            }
            if (virtualPets.length > 0) {
                nextVirtualPetId = Math.max(...virtualPets.map(v => v.id)) + 1;
            }
        }

        // Crear datos de ejemplo
        function createSampleData() {
            // Crear héroes de ejemplo
            const sampleHeroes = [
                {
                    id: 1,
                    username: 'superman',
                    password: '1234',
                    name: 'Clark Kent',
                    alias: 'Superman',
                    city: 'Metrópolis',
                    team: 'Justice League'
                },
                {
                    id: 2,
                    username: 'batman',
                    password: '1234',
                    name: 'Bruce Wayne',
                    alias: 'Batman',
                    city: 'Gotham',
                    team: 'Justice League'
                },
                {
                    id: 3,
                    username: 'spiderman',
                    password: '1234',
                    name: 'Peter Parker',
                    alias: 'Spider-Man',
                    city: 'Nueva York',
                    team: 'Avengers'
                }
            ];

            // Crear mascotas de ejemplo
            const samplePets = [
                {
                    id: 1,
                    name: 'Krypto',
                    type: 'Perro',
                    power: 'Super fuerza y vuelo',
                    adopted: false,
                    ownerId: null
                },
                {
                    id: 2,
                    name: 'Ace',
                    type: 'Perro',
                    power: 'Detective canino',
                    adopted: false,
                    ownerId: null
                },
                {
                    id: 3,
                    name: 'Lucky',
                    type: 'Gato',
                    power: 'Suerte felina',
                    adopted: false,
                    ownerId: null
                },
                {
                    id: 4,
                    name: 'Tweety',
                    type: 'Ave',
                    power: 'Canto mágico',
                    adopted: false,
                    ownerId: null
                }
            ];

            heroes = sampleHeroes;
            pets = samplePets;
            nextHeroId = 4;
            nextPetId = 5;
            saveData();
            
            // Mostrar mensaje de confirmación
            showStatus('login-status', '¡Datos de ejemplo creados! Ahora puedes hacer login con: superman/1234, batman/1234, spiderman/1234', 'success');
            
            // Limpiar campos
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Guardar datos
        function saveData() {
            localStorage.setItem('heroes', JSON.stringify(heroes));
            localStorage.setItem('pets', JSON.stringify(pets));
            localStorage.setItem('adoptions', JSON.stringify(adoptions));
            localStorage.setItem('virtualPets', JSON.stringify(virtualPets));
        }

        // Funciones de navegación
        function showLogin() {
            document.getElementById('register-panel').classList.add('hidden');
            document.getElementById('login-panel').classList.remove('hidden');
        }

        function showRegister() {
            document.getElementById('login-panel').classList.add('hidden');
            document.getElementById('register-panel').classList.remove('hidden');
        }

        function showSection(section) {
            ['heroes', 'pets', 'adoptions', 'virtual-pets'].forEach(s => {
                document.getElementById(s + '-section').classList.add('hidden');
            });
            document.getElementById('pou-panel').classList.add('hidden');
            
            document.getElementById(section + '-section').classList.remove('hidden');
            
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function backToVirtualPets() {
            document.getElementById('pou-panel').classList.add('hidden');
            document.getElementById('virtual-pets-section').classList.remove('hidden');
        }

        // Funciones de autenticación
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showStatus('login-status', 'Usuario y contraseña son obligatorios', 'error');
                return;
            }

            const hero = heroes.find(h => h.username === username && h.password === password);
            if (hero) {
                currentHeroId = hero.id;
                currentHero = hero;
                localStorage.setItem('currentHeroId', currentHeroId);
                showStatus('login-status', '¡Inicio de sesión exitoso!', 'success');
                
                document.getElementById('login-panel').classList.add('hidden');
                document.getElementById('game-panel').classList.remove('hidden');
            } else {
                showStatus('login-status', 'Usuario o contraseña incorrectos', 'error');
            }
        }

        function register() {
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const name = document.getElementById('reg-name').value;
            const alias = document.getElementById('reg-alias').value;

            if (!username || !password || !name || !alias) {
                showStatus('register-status', 'Todos los campos son obligatorios', 'error');
                return;
            }

            if (heroes.find(h => h.username === username)) {
                showStatus('register-status', 'El usuario ya existe', 'error');
                return;
            }

            const newHero = {
                id: nextHeroId++,
                username,
                password,
                name,
                alias,
                city: '',
                team: ''
            };

            heroes.push(newHero);
            saveData();
            showStatus('register-status', '¡Registro exitoso! Ahora puedes hacer login.', 'success');
            showLogin();
        }

        function logout() {
            currentHeroId = null;
            currentHero = null;
            localStorage.removeItem('currentHeroId');
            
            document.getElementById('game-panel').classList.add('hidden');
            document.getElementById('login-panel').classList.remove('hidden');
            
            showStatus('login-status', 'Sesión cerrada', 'info');
        }

        // Funciones de héroes
        function createHero() {
            const name = document.getElementById('hero-name').value;
            const alias = document.getElementById('hero-alias').value;
            const city = document.getElementById('hero-city').value;
            const team = document.getElementById('hero-team').value;

            if (!name || !alias) {
                showStatus('heroes-status', 'Nombre y alias son obligatorios', 'error');
                return;
            }

            const newHero = {
                id: nextHeroId++,
                name,
                alias,
                city,
                team
            };

            heroes.push(newHero);
            saveData();
            showStatus('heroes-status', '¡Héroe creado exitosamente!', 'success');
            clearHeroForm();
            loadHeroes();
        }

        function loadHeroes() {
            const heroesList = document.getElementById('heroes-list');
            heroesList.innerHTML = heroes.map(hero => `
                <div class="card">
                    <div class="pet-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <h3>${hero.name}</h3>
                    <div><strong>Alias:</strong> ${hero.alias}</div>
                    <div><strong>Ciudad:</strong> ${hero.city || 'No especificada'}</div>
                    <div><strong>Equipo:</strong> ${hero.team || 'Sin equipo'}</div>
                    <div><strong>ID:</strong> ${hero.id}</div>
                </div>
            `).join('');
        }

        function clearHeroForm() {
            document.getElementById('hero-name').value = '';
            document.getElementById('hero-alias').value = '';
            document.getElementById('hero-city').value = '';
            document.getElementById('hero-team').value = '';
        }

        // Funciones de mascotas
        function createPet() {
            const name = document.getElementById('pet-name').value;
            const type = document.getElementById('pet-type').value;
            const power = document.getElementById('pet-power').value;

            if (!name || !type) {
                showStatus('pets-status', 'Nombre y tipo son obligatorios', 'error');
                return;
            }

            const newPet = {
                id: nextPetId++,
                name,
                type,
                power,
                adopted: false,
                ownerId: null
            };

            pets.push(newPet);
            saveData();
            showStatus('pets-status', '¡Mascota creada exitosamente!', 'success');
            clearPetForm();
            loadPets();
        }

        function loadPets() {
            const petsList = document.getElementById('pets-list');
            petsList.innerHTML = pets.map(pet => `
                <div class="card">
                    <div class="pet-avatar">
                        <i class="fas fa-paw"></i>
                    </div>
                    <h3>${pet.name}</h3>
                    <div><strong>Tipo:</strong> ${pet.type}</div>
                    <div><strong>Poder:</strong> ${pet.power || 'Sin poder'}</div>
                    <div><strong>ID:</strong> ${pet.id}</div>
                    <div><strong>Estado:</strong> ${pet.adopted ? 'Adoptada' : 'Disponible'}</div>
                </div>
            `).join('');
        }

        function clearPetForm() {
            document.getElementById('pet-name').value = '';
            document.getElementById('pet-type').value = '';
            document.getElementById('pet-power').value = '';
        }

        // Funciones de adopciones
        function adoptPet() {
            const petId = parseInt(document.getElementById('adopt-pet-id').value);

            if (!petId) {
                showStatus('adoptions-status', 'Por favor ingresa el ID de la mascota', 'error');
                return;
            }

            const pet = pets.find(p => p.id === petId);
            if (!pet) {
                showStatus('adoptions-status', 'Mascota no encontrada', 'error');
                return;
            }

            if (pet.adopted) {
                showStatus('adoptions-status', 'La mascota ya está adoptada', 'error');
                return;
            }

            pet.adopted = true;
            pet.ownerId = currentHeroId;

            const adoption = {
                id: adoptions.length + 1,
                petId: pet.id,
                petName: pet.name,
                petType: pet.type,
                heroId: currentHeroId,
                fecha: new Date().toISOString()
            };

            adoptions.push(adoption);
            saveData();
            showStatus('adoptions-status', '¡Mascota adoptada exitosamente!', 'success');
            document.getElementById('adopt-pet-id').value = '';
            loadMyAdoptions();
        }

        function loadMyAdoptions() {
            const myAdoptions = adoptions.filter(a => a.heroId === currentHeroId);
            const adoptionsList = document.getElementById('adoptions-list');
            adoptionsList.innerHTML = myAdoptions.map(adoption => `
                <div class="card">
                    <div class="pet-avatar">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3>${adoption.petName}</h3>
                    <div><strong>Tipo:</strong> ${adoption.petType}</div>
                    <div><strong>Fecha:</strong> ${new Date(adoption.fecha).toLocaleDateString()}</div>
                    <div><strong>ID Mascota:</strong> ${adoption.petId}</div>
                </div>
            `).join('');
        }

        // Funciones de mascotas virtuales
        function createVirtualPet() {
            const petId = parseInt(document.getElementById('virtual-pet-id').value);

            if (!petId) {
                showStatus('virtual-pets-status', 'Por favor ingresa el ID de la mascota adoptada', 'error');
                return;
            }

            const pet = pets.find(p => p.id === petId && p.ownerId === currentHeroId);
            if (!pet) {
                showStatus('virtual-pets-status', 'Mascota no encontrada o no adoptada por ti', 'error');
                return;
            }

            const existingVirtualPet = virtualPets.find(v => v.petId === petId);
            if (existingVirtualPet) {
                showStatus('virtual-pets-status', 'Ya tienes una mascota virtual de esta mascota', 'error');
                return;
            }

            const newVirtualPet = {
                id: nextVirtualPetId++,
                petId: pet.id,
                nombre: pet.name,
                salud: 50,  // Empezar con salud media
                felicidad: 50,  // Empezar con felicidad media
                hambre: 50,  // Empezar con algo de hambre
                muerta: false,
                enferma: false,
                satisfecha: false  // Empezar con hambre
            };

            virtualPets.push(newVirtualPet);
            saveData();
            showStatus('virtual-pets-status', '¡Mascota virtual creada exitosamente!', 'success');
            document.getElementById('virtual-pet-id').value = '';
            loadVirtualPets();
        }

        function loadVirtualPets() {
            const myVirtualPets = virtualPets.filter(v => {
                const pet = pets.find(p => p.id === v.petId);
                return pet && pet.ownerId === currentHeroId;
            });

            const virtualPetsList = document.getElementById('virtual-pets-list');
            
            if (myVirtualPets.length === 0) {
                virtualPetsList.innerHTML = `
                    <div class="card">
                        <div class="pet-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3>No tienes mascotas virtuales</h3>
                        <p>Crea una mascota virtual desde una mascota adoptada</p>
                    </div>
                `;
            } else {
                virtualPetsList.innerHTML = myVirtualPets.map(pet => `
                    <div class="card" onclick="openPouPanel(${pet.id})" style="cursor: pointer;">
                        <div class="pet-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3>${pet.nombre}</h3>
                        <div><strong>Salud:</strong> ${pet.salud}/100</div>
                        <div><strong>Felicidad:</strong> ${pet.felicidad}/100</div>
                        <div><strong>Estado:</strong> ${pet.muerta ? 'Muerta' : pet.enferma ? 'Enferma' : 'Sana'}</div>
                        <div><strong>ID:</strong> ${pet.id}</div>
                        <button class="btn btn-success" onclick="event.stopPropagation(); openPouPanel(${pet.id})">
                            <i class="fas fa-play"></i> Cuidar
                        </button>
                    </div>
                `).join('');
            }
        }

        // Funciones del panel Pou
        function openPouPanel(petId) {
            currentVirtualPetId = petId;
            document.getElementById('virtual-pets-section').classList.add('hidden');
            document.getElementById('pou-panel').classList.remove('hidden');
            loadPouPet();
        }

        function loadPouPet() {
            currentVirtualPet = virtualPets.find(v => v.id === currentVirtualPetId);
            if (currentVirtualPet) {
                updatePouDisplay();
            }
        }

        function updatePouDisplay() {
            if (!currentVirtualPet) return;

            document.getElementById('pou-name').textContent = currentVirtualPet.nombre;
            
            document.getElementById('health-bar').style.width = `${currentVirtualPet.salud}%`;
            document.getElementById('health-value').textContent = currentVirtualPet.salud;
            
            document.getElementById('happiness-bar').style.width = `${currentVirtualPet.felicidad}%`;
            document.getElementById('happiness-value').textContent = currentVirtualPet.felicidad;
            
            const hunger = currentVirtualPet.satisfecha ? 20 : 80;
            document.getElementById('hunger-bar').style.width = `${hunger}%`;
            document.getElementById('hunger-value').textContent = hunger;
            
            const status = currentVirtualPet.muerta ? 'Muerta' : currentVirtualPet.enferma ? 'Enferma' : 'Sana';
            document.getElementById('pet-status').textContent = status;
            
            const avatar = document.getElementById('pou-avatar');
            if (currentVirtualPet.muerta) {
                avatar.style.filter = 'grayscale(100%)';
            } else if (currentVirtualPet.enferma) {
                avatar.style.filter = 'sepia(50%)';
            } else {
                avatar.style.filter = 'none';
            }
        }

        // Funciones de actividades Pou
        function feedPet() {
            if (!currentVirtualPet) return;
            
            if (currentVirtualPet.muerta) {
                showStatus('pou-status', 'No puedes alimentar una mascota muerta', 'error');
                return;
            }

            // Lógica más realista: alimentar demasiado puede hacer daño
            if (currentVirtualPet.satisfecha) {
                // Si ya está satisfecha, alimentar más hace daño
                currentVirtualPet.salud = Math.max(0, currentVirtualPet.salud - 15);
                currentVirtualPet.felicidad = Math.max(0, currentVirtualPet.felicidad - 10);
                showStatus('pou-status', '¡La mascota ya estaba llena! Alimentarla más le hizo daño.', 'error');
            } else {
                // Si tiene hambre, alimentarla es bueno
                currentVirtualPet.salud = Math.min(100, currentVirtualPet.salud + 15);
                currentVirtualPet.felicidad = Math.min(100, currentVirtualPet.felicidad + 10);
                showStatus('pou-status', '¡Mascota alimentada! Se ve más feliz.', 'success');
            }
            
            currentVirtualPet.satisfecha = true;
            
            // Verificar si murió por sobrealimentación
            if (currentVirtualPet.salud <= 0) {
                currentVirtualPet.muerta = true;
                showStatus('pou-status', '¡La mascota murió por sobrealimentación!', 'error');
            }
            
            updatePouDisplay();
            saveData();
            document.getElementById('last-activity').textContent = '¡Mascota alimentada!';
        }

        function playWithPet() {
            if (!currentVirtualPet) return;
            
            if (currentVirtualPet.muerta) {
                showStatus('pou-status', 'No puedes jugar con una mascota muerta', 'error');
                return;
            }

            currentVirtualPet.felicidad = Math.min(100, currentVirtualPet.felicidad + 30);
            currentVirtualPet.salud = Math.max(0, currentVirtualPet.salud - 5);
            
            updatePouDisplay();
            saveData();
            document.getElementById('last-activity').textContent = '¡Jugaste con tu mascota!';
            showStatus('pou-status', '¡Jugaste con tu mascota!', 'success');
        }

        function walkPet() {
            if (!currentVirtualPet) return;
            
            if (currentVirtualPet.muerta) {
                showStatus('pou-status', 'No puedes pasear una mascota muerta', 'error');
                return;
            }

            currentVirtualPet.felicidad = Math.min(100, currentVirtualPet.felicidad + 20);
            currentVirtualPet.salud = Math.min(100, currentVirtualPet.salud + 10);
            currentVirtualPet.satisfecha = false;
            
            updatePouDisplay();
            saveData();
            document.getElementById('last-activity').textContent = '¡Paseaste con tu mascota!';
            showStatus('pou-status', '¡Paseaste con tu mascota!', 'success');
        }

        function healPet() {
            if (!currentVirtualPet) return;
            
            if (currentVirtualPet.muerta) {
                showStatus('pou-status', 'No puedes curar una mascota muerta', 'error');
                return;
            }

            currentVirtualPet.salud = 100;
            currentVirtualPet.enferma = false;
            
            updatePouDisplay();
            saveData();
            document.getElementById('last-activity').textContent = '¡Mascota curada!';
            showStatus('pou-status', '¡Mascota curada!', 'success');
        }

        function revivePet() {
            if (!currentVirtualPet) return;
            
            if (!currentVirtualPet.muerta) {
                showStatus('pou-status', 'La mascota no está muerta', 'error');
                return;
            }

            currentVirtualPet.muerta = false;
            currentVirtualPet.salud = 50;
            currentVirtualPet.felicidad = 50;
            currentVirtualPet.enferma = false;
            currentVirtualPet.satisfecha = true;
            
            updatePouDisplay();
            saveData();
            document.getElementById('last-activity').textContent = '¡Mascota revivida!';
            showStatus('pou-status', '¡Mascota revivida!', 'success');
        }

        // Función auxiliar para mostrar estados
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status ${type}">${message}</div>`;
                setTimeout(() => {
                    if (element) {
                        element.innerHTML = '';
                    }
                }, 5000);
            }
        }

        // Función para degradar automáticamente las mascotas virtuales
        function degradeVirtualPets() {
            virtualPets.forEach(pet => {
                if (!pet.muerta) {
                    // Degradar salud y felicidad gradualmente
                    pet.salud = Math.max(0, pet.salud - 2);
                    pet.felicidad = Math.max(0, pet.felicidad - 1);
                    
                    // Si la salud llega a 0, la mascota muere
                    if (pet.salud <= 0) {
                        pet.muerta = true;
                        showStatus('pou-status', `¡${pet.nombre} murió por falta de cuidados!`, 'error');
                    }
                    
                    // Si la salud es baja, se enferma
                    if (pet.salud < 20 && !pet.enferma) {
                        pet.enferma = true;
                        showStatus('pou-status', `¡${pet.nombre} se enfermó!`, 'error');
                    }
                }
            });
            saveData();
        }

        // Degradar mascotas cada 30 segundos
        setInterval(degradeVirtualPets, 30000);

        // Función para reiniciar el juego
        function resetGame() {
            if (confirm('¿Estás seguro de que quieres reiniciar el juego? Se perderán todos los datos.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            
            // Verificar si los datos se cargaron correctamente
            console.log('Héroes cargados:', heroes);
            console.log('Mascotas cargadas:', pets);
            
            const savedHeroId = localStorage.getItem('currentHeroId');
            if (savedHeroId) {
                currentHeroId = parseInt(savedHeroId);
                currentHero = heroes.find(h => h.id === currentHeroId);
                if (currentHero) {
                    document.getElementById('login-panel').classList.add('hidden');
                    document.getElementById('game-panel').classList.remove('hidden');
                }
            }
        });
    </script>
</body>
</html> 