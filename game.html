<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Héroes y Mascotas - Juego Simple</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: rgba(255,255,255,0.9);
            color: #667eea;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
        }

        .nav-button:hover, .nav-button.active {
            background: #667eea;
            color: white;
        }

        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
        }

        .pet-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Panel Pou simplificado */
        .pou-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .pou-pet {
            text-align: center;
        }

        .pou-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
        }

        .pou-stats {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stat-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            border-radius: 10px;
        }

        .health-fill {
            background: #28a745;
        }

        .happiness-fill {
            background: #ffc107;
        }

        .hunger-fill {
            background: #dc3545;
        }

        .pou-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .action-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
        }

        .action-btn:hover {
            background: #5a6fd8;
        }

        .action-btn.feed {
            background: #28a745;
        }

        .action-btn.play {
            background: #ffc107;
            color: #333;
        }

        .action-btn.walk {
            background: #17a2b8;
        }

        .action-btn.heal {
            background: #dc3545;
        }

        .action-btn.revive {
            background: #6f42c1;
        }

        @media (max-width: 768px) {
            .pou-container {
                grid-template-columns: 1fr;
            }
            
            .nav-menu {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> Héroes y Mascotas</h1>
            <p>¡Juego simplificado y funcional!</p>
        </div>

        <!-- Panel de Login -->
        <div class="panel" id="login-panel">
            <h2><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</h2>
            <div id="login-status"></div>
            
            <div class="form-group">
                <label for="username">Usuario:</label>
                <input type="text" id="username" placeholder="Tu nombre de usuario">
            </div>
            <div class="form-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" placeholder="Tu contraseña">
            </div>
            <button class="btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
            </button>
            <button class="btn btn-success" onclick="showRegister()">
                <i class="fas fa-user-plus"></i> Registrarse
            </button>
        </div>

        <!-- Panel de Registro -->
        <div class="panel hidden" id="register-panel">
            <h2><i class="fas fa-user-plus"></i> Registrarse</h2>
            <div id="register-status"></div>
            
            <div class="form-group">
                <label for="reg-username">Usuario:</label>
                <input type="text" id="reg-username" placeholder="Nombre de usuario">
            </div>
            <div class="form-group">
                <label for="reg-password">Contraseña:</label>
                <input type="password" id="reg-password" placeholder="Contraseña">
            </div>
            <div class="form-group">
                <label for="reg-name">Nombre del Héroe:</label>
                <input type="text" id="reg-name" placeholder="Nombre real del héroe">
            </div>
            <div class="form-group">
                <label for="reg-alias">Alias:</label>
                <input type="text" id="reg-alias" placeholder="Alias del héroe">
            </div>
            <button class="btn btn-success" onclick="register()">
                <i class="fas fa-user-plus"></i> Registrarse
            </button>
            <button class="btn" onclick="showLogin()">
                <i class="fas fa-arrow-left"></i> Volver al Login
            </button>
        </div>

        <!-- Panel Principal del Juego -->
        <div class="panel hidden" id="game-panel">
            <h2><i class="fas fa-gamepad"></i> Panel Principal</h2>
            <div id="game-status"></div>
            
            <!-- Menú de Navegación -->
            <div class="nav-menu">
                <button class="nav-button active" onclick="showSection('heroes')">
                    <i class="fas fa-users"></i> Héroes
                </button>
                <button class="nav-button" onclick="showSection('pets')">
                    <i class="fas fa-paw"></i> Mascotas
                </button>
                <button class="nav-button" onclick="showSection('adoptions')">
                    <i class="fas fa-heart"></i> Adopciones
                </button>
                <button class="nav-button" onclick="showSection('virtual-pets')">
                    <i class="fas fa-robot"></i> Mascotas Virtuales
                </button>
                <button class="nav-button btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
            </div>

            <!-- Sección de Héroes -->
            <div id="heroes-section">
                <h3><i class="fas fa-users"></i> Gestión de Héroes</h3>
                <div id="heroes-status"></div>
                
                <div class="form-group">
                    <label for="hero-name">Nombre:</label>
                    <input type="text" id="hero-name" placeholder="Nombre del héroe">
                </div>
                <div class="form-group">
                    <label for="hero-alias">Alias:</label>
                    <input type="text" id="hero-alias" placeholder="Alias del héroe">
                </div>
                <div class="form-group">
                    <label for="hero-city">Ciudad:</label>
                    <input type="text" id="hero-city" placeholder="Ciudad del héroe">
                </div>
                <div class="form-group">
                    <label for="hero-team">Equipo:</label>
                    <input type="text" id="hero-team" placeholder="Equipo del héroe">
                </div>
                <button class="btn" onclick="createHero()">
                    <i class="fas fa-plus"></i> Crear Héroe
                </button>
                <button class="btn btn-success" onclick="loadHeroes()">
                    <i class="fas fa-list"></i> Ver Todos
                </button>
                
                <div id="heroes-list"></div>
            </div>

            <!-- Sección de Mascotas -->
            <div id="pets-section" class="hidden">
                <h3><i class="fas fa-paw"></i> Gestión de Mascotas</h3>
                <div id="pets-status"></div>
                
                <div class="form-group">
                    <label for="pet-name">Nombre:</label>
                    <input type="text" id="pet-name" placeholder="Nombre de la mascota">
                </div>
                <div class="form-group">
                    <label for="pet-type">Tipo:</label>
                    <select id="pet-type">
                        <option value="">Selecciona un tipo</option>
                        <option value="Perro">Perro</option>
                        <option value="Gato">Gato</option>
                        <option value="Ave">Ave</option>
                        <option value="Reptil">Reptil</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pet-power">Poder:</label>
                    <input type="text" id="pet-power" placeholder="Poder de la mascota">
                </div>
                <button class="btn" onclick="createPet()">
                    <i class="fas fa-plus"></i> Crear Mascota
                </button>
                <button class="btn btn-success" onclick="loadPets()">
                    <i class="fas fa-list"></i> Ver Todas
                </button>
                
                <div id="pets-list"></div>
            </div>

            <!-- Sección de Adopciones -->
            <div id="adoptions-section" class="hidden">
                <h3><i class="fas fa-heart"></i> Adopciones</h3>
                <div id="adoptions-status"></div>
                
                <div class="form-group">
                    <label for="adopt-pet-id">ID de la Mascota:</label>
                    <input type="number" id="adopt-pet-id" placeholder="ID de la mascota a adoptar">
                </div>
                <button class="btn btn-success" onclick="adoptPet()">
                    <i class="fas fa-heart"></i> Adoptar Mascota
                </button>
                <button class="btn btn-success" onclick="loadMyAdoptions()">
                    <i class="fas fa-list"></i> Ver Mis Adopciones
                </button>
                
                <div id="adoptions-list"></div>
            </div>

            <!-- Sección de Mascotas Virtuales -->
            <div id="virtual-pets-section" class="hidden">
                <h3><i class="fas fa-robot"></i> Mascotas Virtuales</h3>
                <div id="virtual-pets-status"></div>
                
                <div class="form-group">
                    <label for="virtual-pet-id">ID de la Mascota Adoptada:</label>
                    <input type="number" id="virtual-pet-id" placeholder="ID de la mascota adoptada">
                </div>
                <button class="btn" onclick="createVirtualPet()">
                    <i class="fas fa-plus"></i> Crear Mascota Virtual
                </button>
                <button class="btn btn-success" onclick="loadVirtualPets()">
                    <i class="fas fa-list"></i> Ver Mascotas Virtuales
                </button>
                
                <div id="virtual-pets-list"></div>
            </div>

            <!-- Panel de Mascota Virtual Individual (Estilo Pou) -->
            <div id="pou-panel" class="hidden">
                <h3><i class="fas fa-robot"></i> Mi Mascota Virtual</h3>
                <div id="pou-status"></div>
                
                <div class="pou-container">
                    <!-- Lado izquierdo: Mascota y estadísticas -->
                    <div class="pou-pet">
                        <div class="pou-avatar" id="pou-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h4 id="pou-name">Cargando...</h4>
                        
                        <div class="pou-stats">
                            <h5><i class="fas fa-heartbeat"></i> Salud</h5>
                            <div class="stat-bar">
                                <div class="stat-fill health-fill" id="health-bar" style="width: 0%"></div>
                            </div>
                            <span id="health-value">0</span>/100
                            
                            <h5><i class="fas fa-smile"></i> Felicidad</h5>
                            <div class="stat-bar">
                                <div class="stat-fill happiness-fill" id="happiness-bar" style="width: 0%"></div>
                            </div>
                            <span id="happiness-value">0</span>/100
                            
                            <h5><i class="fas fa-utensils"></i> Hambre</h5>
                            <div class="stat-bar">
                                <div class="stat-fill hunger-fill" id="hunger-bar" style="width: 0%"></div>
                            </div>
                            <span id="hunger-value">0</span>/100
                            
                            <h5><i class="fas fa-info-circle"></i> Estado</h5>
                            <div id="pet-status">Cargando...</div>
                        </div>
                    </div>
                    
                    <!-- Lado derecho: Acciones -->
                    <div>
                        <div class="pou-actions">
                            <button class="action-btn feed" onclick="feedPet()">
                                <i class="fas fa-utensils"></i> Alimentar
                            </button>
                            <button class="action-btn play" onclick="playWithPet()">
                                <i class="fas fa-dice"></i> Jugar
                            </button>
                            <button class="action-btn walk" onclick="walkPet()">
                                <i class="fas fa-walking"></i> Pasear
                            </button>
                            <button class="action-btn heal" onclick="healPet()">
                                <i class="fas fa-first-aid"></i> Curar
                            </button>
                            <button class="action-btn revive" onclick="revivePet()">
                                <i class="fas fa-heart"></i> Revivir
                            </button>
                        </div>
                        
                        <div class="card">
                            <h5><i class="fas fa-history"></i> Última Actividad</h5>
                            <div id="last-activity">Ninguna actividad realizada</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="backToVirtualPets()">
                    <i class="fas fa-arrow-left"></i> Volver a Mascotas Virtuales
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://heroesymascotas-production-aba1.up.railway.app';
        let currentHeroId = null;
        let currentHero = null;
        let currentVirtualPet = null;
        let currentVirtualPetId = null;

        // Función simple para hacer fetch
        async function simpleFetch(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                return response;
            } catch (error) {
                console.error('Error de fetch:', error);
                throw new Error('Error de conexión');
            }
        }

        // Funciones de navegación
        function showLogin() {
            document.getElementById('register-panel').classList.add('hidden');
            document.getElementById('login-panel').classList.remove('hidden');
        }

        function showRegister() {
            document.getElementById('login-panel').classList.add('hidden');
            document.getElementById('register-panel').classList.remove('hidden');
        }

        function showSection(section) {
            // Ocultar todas las secciones
            ['heroes', 'pets', 'adoptions', 'virtual-pets'].forEach(s => {
                document.getElementById(s + '-section').classList.add('hidden');
            });
            document.getElementById('pou-panel').classList.add('hidden');
            
            // Mostrar la sección seleccionada
            document.getElementById(section + '-section').classList.remove('hidden');
            
            // Actualizar botones activos
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function backToVirtualPets() {
            document.getElementById('pou-panel').classList.add('hidden');
            document.getElementById('virtual-pets-section').classList.remove('hidden');
        }

        // Funciones de autenticación
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showStatus('login-status', 'Usuario y contraseña son obligatorios', 'error');
                return;
            }

            try {
                const response = await simpleFetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.token) {
                        currentHeroId = data.token;
                        localStorage.setItem('currentHeroId', currentHeroId);
                        showStatus('login-status', '¡Inicio de sesión exitoso!', 'success');
                        
                        document.getElementById('login-panel').classList.add('hidden');
                        document.getElementById('game-panel').classList.remove('hidden');
                    } else {
                        throw new Error('No se recibió token');
                    }
                } else {
                    const errorData = await response.json().catch(() => ({ error: 'Error desconocido' }));
                    throw new Error(errorData.error || 'Error en login');
                }
            } catch (error) {
                showStatus('login-status', error.message, 'error');
            }
        }

        async function register() {
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const name = document.getElementById('reg-name').value;
            const alias = document.getElementById('reg-alias').value;

            if (!username || !password || !name || !alias) {
                showStatus('register-status', 'Todos los campos son obligatorios', 'error');
                return;
            }

            try {
                const response = await simpleFetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    body: JSON.stringify({ username, password, name, alias })
                });

                if (response.ok) {
                    showStatus('register-status', '¡Registro exitoso! Ahora puedes hacer login.', 'success');
                    showLogin();
                } else {
                    const errorData = await response.json().catch(() => ({ error: 'Error desconocido' }));
                    throw new Error(errorData.error || 'Error en registro');
                }
            } catch (error) {
                showStatus('register-status', error.message, 'error');
            }
        }

        function logout() {
            currentHeroId = null;
            currentHero = null;
            localStorage.removeItem('currentHeroId');
            
            document.getElementById('game-panel').classList.add('hidden');
            document.getElementById('login-panel').classList.remove('hidden');
            
            showStatus('login-status', 'Sesión cerrada', 'info');
        }

        // Funciones de héroes
        async function createHero() {
            const name = document.getElementById('hero-name').value;
            const alias = document.getElementById('hero-alias').value;
            const city = document.getElementById('hero-city').value;
            const team = document.getElementById('hero-team').value;

            if (!name || !alias) {
                showStatus('heroes-status', 'Nombre y alias son obligatorios', 'error');
                return;
            }

            try {
                const response = await simpleFetch(`${API_BASE}/api/heroes`, {
                    method: 'POST',
                    body: JSON.stringify({ name, alias, city, team })
                });

                if (response.ok) {
                    showStatus('heroes-status', '¡Héroe creado exitosamente!', 'success');
                    clearHeroForm();
                    loadHeroes();
                } else {
                    const data = await response.json();
                    showStatus('heroes-status', data.error || 'Error creando héroe', 'error');
                }
            } catch (error) {
                showStatus('heroes-status', error.message, 'error');
            }
        }

        async function loadHeroes() {
            try {
                const response = await simpleFetch(`${API_BASE}/api/heroes`);
                if (response.ok) {
                    const heroes = await response.json();
                    const heroesList = document.getElementById('heroes-list');
                    heroesList.innerHTML = heroes.map(hero => `
                        <div class="card">
                            <div class="pet-avatar">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <h3>${hero.name}</h3>
                            <div><strong>Alias:</strong> ${hero.alias}</div>
                            <div><strong>Ciudad:</strong> ${hero.city || 'No especificada'}</div>
                            <div><strong>Equipo:</strong> ${hero.team || 'Sin equipo'}</div>
                            <div><strong>ID:</strong> ${hero.id}</div>
                        </div>
                    `).join('');
                } else {
                    showStatus('heroes-status', 'Error cargando héroes', 'error');
                }
            } catch (error) {
                showStatus('heroes-status', error.message, 'error');
            }
        }

        function clearHeroForm() {
            document.getElementById('hero-name').value = '';
            document.getElementById('hero-alias').value = '';
            document.getElementById('hero-city').value = '';
            document.getElementById('hero-team').value = '';
        }

        // Funciones de mascotas
        async function createPet() {
            const name = document.getElementById('pet-name').value;
            const type = document.getElementById('pet-type').value;
            const power = document.getElementById('pet-power').value;

            if (!name || !type) {
                showStatus('pets-status', 'Nombre y tipo son obligatorios', 'error');
                return;
            }

            try {
                const response = await simpleFetch(`${API_BASE}/api/pets`, {
                    method: 'POST',
                    headers: { 'x-hero-id': currentHeroId },
                    body: JSON.stringify({ name, type, power })
                });

                if (response.ok) {
                    showStatus('pets-status', '¡Mascota creada exitosamente!', 'success');
                    clearPetForm();
                    loadPets();
                } else {
                    const data = await response.json();
                    showStatus('pets-status', data.error || 'Error creando mascota', 'error');
                }
            } catch (error) {
                showStatus('pets-status', error.message, 'error');
            }
        }

        async function loadPets() {
            try {
                const response = await simpleFetch(`${API_BASE}/api/pets`, {
                    headers: { 'x-hero-id': currentHeroId }
                });
                
                if (response.ok) {
                    const pets = await response.json();
                    const petsList = document.getElementById('pets-list');
                    petsList.innerHTML = pets.map(pet => `
                        <div class="card">
                            <div class="pet-avatar">
                                <i class="fas fa-paw"></i>
                            </div>
                            <h3>${pet.name}</h3>
                            <div><strong>Tipo:</strong> ${pet.type}</div>
                            <div><strong>Poder:</strong> ${pet.power || 'Sin poder'}</div>
                            <div><strong>ID:</strong> ${pet.id}</div>
                            <div><strong>Estado:</strong> ${pet.adopted ? 'Adoptada' : 'Disponible'}</div>
                        </div>
                    `).join('');
                } else {
                    showStatus('pets-status', 'Error cargando mascotas', 'error');
                }
            } catch (error) {
                showStatus('pets-status', error.message, 'error');
            }
        }

        function clearPetForm() {
            document.getElementById('pet-name').value = '';
            document.getElementById('pet-type').value = '';
            document.getElementById('pet-power').value = '';
        }

        // Funciones de adopciones
        async function adoptPet() {
            const petId = document.getElementById('adopt-pet-id').value;

            if (!petId) {
                showStatus('adoptions-status', 'Por favor ingresa el ID de la mascota', 'error');
                return;
            }

            try {
                const response = await simpleFetch(`${API_BASE}/api/adopt/${petId}`, {
                    method: 'POST',
                    headers: { 'x-hero-id': currentHeroId }
                });

                if (response.ok) {
                    showStatus('adoptions-status', '¡Mascota adoptada exitosamente!', 'success');
                    document.getElementById('adopt-pet-id').value = '';
                    loadMyAdoptions();
                } else {
                    const data = await response.json();
                    showStatus('adoptions-status', data.error || 'Error adoptando mascota', 'error');
                }
            } catch (error) {
                showStatus('adoptions-status', error.message, 'error');
            }
        }

        async function loadMyAdoptions() {
            try {
                const response = await simpleFetch(`${API_BASE}/api/adoptions`, {
                    headers: { 'x-hero-id': currentHeroId }
                });
                
                if (response.ok) {
                    const adoptions = await response.json();
                    const adoptionsList = document.getElementById('adoptions-list');
                    adoptionsList.innerHTML = adoptions.map(adoption => `
                        <div class="card">
                            <div class="pet-avatar">
                                <i class="fas fa-heart"></i>
                            </div>
                            <h3>${adoption.petName}</h3>
                            <div><strong>Tipo:</strong> ${adoption.petType}</div>
                            <div><strong>Fecha:</strong> ${new Date(adoption.fecha).toLocaleDateString()}</div>
                            <div><strong>ID Mascota:</strong> ${adoption.petId}</div>
                        </div>
                    `).join('');
                } else {
                    showStatus('adoptions-status', 'Error cargando adopciones', 'error');
                }
            } catch (error) {
                showStatus('adoptions-status', error.message, 'error');
            }
        }

        // Funciones de mascotas virtuales
        async function createVirtualPet() {
            const petId = document.getElementById('virtual-pet-id').value;

            if (!petId) {
                showStatus('virtual-pets-status', 'Por favor ingresa el ID de la mascota adoptada', 'error');
                return;
            }

            try {
                const response = await simpleFetch(`${API_BASE}/api/virtual/virtual-pets`, {
                    method: 'POST',
                    headers: { 'x-hero-id': currentHeroId },
                    body: JSON.stringify({ petId: parseInt(petId) })
                });

                if (response.ok) {
                    showStatus('virtual-pets-status', '¡Mascota virtual creada exitosamente!', 'success');
                    document.getElementById('virtual-pet-id').value = '';
                    loadVirtualPets();
                } else {
                    const data = await response.json();
                    showStatus('virtual-pets-status', data.error || 'Error creando mascota virtual', 'error');
                }
            } catch (error) {
                showStatus('virtual-pets-status', error.message, 'error');
            }
        }

        async function loadVirtualPets() {
            try {
                const response = await simpleFetch(`${API_BASE}/api/virtual/virtual-pets`, {
                    headers: { 'x-hero-id': currentHeroId }
                });
                
                if (response.ok) {
                    const virtualPets = await response.json();
                    const virtualPetsList = document.getElementById('virtual-pets-list');
                    
                    if (virtualPets.length === 0) {
                        virtualPetsList.innerHTML = `
                            <div class="card">
                                <div class="pet-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <h3>No tienes mascotas virtuales</h3>
                                <p>Crea una mascota virtual desde una mascota adoptada</p>
                            </div>
                        `;
                    } else {
                        virtualPetsList.innerHTML = virtualPets.map(pet => `
                            <div class="card" onclick="openPouPanel(${pet.id})" style="cursor: pointer;">
                                <div class="pet-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <h3>${pet.nombre}</h3>
                                <div><strong>Salud:</strong> ${pet.salud}/100</div>
                                <div><strong>Felicidad:</strong> ${pet.felicidad}/100</div>
                                <div><strong>Estado:</strong> ${pet.muerta ? 'Muerta' : pet.enferma ? 'Enferma' : 'Sana'}</div>
                                <div><strong>ID:</strong> ${pet.id}</div>
                                <button class="btn btn-success" onclick="event.stopPropagation(); openPouPanel(${pet.id})">
                                    <i class="fas fa-play"></i> Cuidar
                                </button>
                            </div>
                        `).join('');
                    }
                } else {
                    showStatus('virtual-pets-status', 'Error cargando mascotas virtuales', 'error');
                }
            } catch (error) {
                showStatus('virtual-pets-status', error.message, 'error');
            }
        }

        // Funciones del panel Pou
        async function openPouPanel(petId) {
            currentVirtualPetId = petId;
            document.getElementById('virtual-pets-section').classList.add('hidden');
            document.getElementById('pou-panel').classList.remove('hidden');
            await loadPouPet();
        }

        async function loadPouPet() {
            try {
                const response = await simpleFetch(`${API_BASE}/api/virtual/virtual-pets/${currentVirtualPetId}`, {
                    headers: { 'x-hero-id': currentHeroId }
                });

                if (response.ok) {
                    currentVirtualPet = await response.json();
                    updatePouDisplay();
                } else {
                    showStatus('pou-status', 'Error cargando mascota virtual', 'error');
                }
            } catch (error) {
                showStatus('pou-status', error.message, 'error');
            }
        }

        function updatePouDisplay() {
            if (!currentVirtualPet) return;

            document.getElementById('pou-name').textContent = currentVirtualPet.nombre;
            
            // Actualizar barras de estado
            document.getElementById('health-bar').style.width = `${currentVirtualPet.salud}%`;
            document.getElementById('health-value').textContent = currentVirtualPet.salud;
            
            document.getElementById('happiness-bar').style.width = `${currentVirtualPet.felicidad}%`;
            document.getElementById('happiness-value').textContent = currentVirtualPet.felicidad;
            
            // Calcular hambre (inverso de satisfecha)
            const hunger = currentVirtualPet.satisfecha ? 20 : 80;
            document.getElementById('hunger-bar').style.width = `${hunger}%`;
            document.getElementById('hunger-value').textContent = hunger;
            
            // Actualizar estado
            const status = currentVirtualPet.muerta ? 'Muerta' : currentVirtualPet.enferma ? 'Enferma' : 'Sana';
            document.getElementById('pet-status').textContent = status;
            
            // Cambiar color del avatar según estado
            const avatar = document.getElementById('pou-avatar');
            if (currentVirtualPet.muerta) {
                avatar.style.filter = 'grayscale(100%)';
            } else if (currentVirtualPet.enferma) {
                avatar.style.filter = 'sepia(50%)';
            } else {
                avatar.style.filter = 'none';
            }
        }

        // Funciones de actividades Pou
        async function feedPet() {
            await performActivity('feed', { comida: 'croquetas' });
        }

        async function playWithPet() {
            await performActivity('play');
        }

        async function walkPet() {
            await performActivity('walk');
        }

        async function healPet() {
            await performActivity('heal');
        }

        async function revivePet() {
            await performActivity('revive');
        }

        async function performActivity(activity, body = {}) {
            if (!currentVirtualPetId) return;
            
            try {
                const response = await simpleFetch(`${API_BASE}/api/virtual/virtual-pets/${currentVirtualPetId}/${activity}`, {
                    method: 'POST',
                    headers: { 'x-hero-id': currentHeroId },
                    body: JSON.stringify(body)
                });

                if (response.ok) {
                    const result = await response.json();
                    currentVirtualPet = result;
                    updatePouDisplay();
                    
                    const messages = {
                        feed: '¡Mascota alimentada!',
                        play: '¡Jugaste con tu mascota!',
                        walk: '¡Paseaste con tu mascota!',
                        heal: '¡Mascota curada!',
                        revive: '¡Mascota revivida!'
                    };
                    
                    document.getElementById('last-activity').textContent = messages[activity] || 'Actividad realizada';
                    showStatus('pou-status', messages[activity] || 'Actividad realizada', 'success');
                } else {
                    const error = await response.json();
                    showStatus('pou-status', error.error || 'Error en la actividad', 'error');
                }
            } catch (error) {
                showStatus('pou-status', error.message, 'error');
            }
        }

        // Función auxiliar para mostrar estados
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status ${type}">${message}</div>`;
                setTimeout(() => {
                    if (element) {
                        element.innerHTML = '';
                    }
                }, 5000);
            }
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si hay sesión guardada
            const savedHeroId = localStorage.getItem('currentHeroId');
            if (savedHeroId) {
                currentHeroId = savedHeroId;
                document.getElementById('login-panel').classList.add('hidden');
                document.getElementById('game-panel').classList.remove('hidden');
            }
        });
    </script>
</body>
</html> 