<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H√©roes y Mascotas - Juego con MongoDB</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #0e4b99 100%);
            min-height: 100vh;
            color: #e0e0e0;
            animation: gamingGradientShift 15s ease infinite;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 0, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(0, 255, 0, 0.05) 0%, transparent 50%);
            animation: neuraGlow 8s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes gamingGradientShift {
            0%, 100% { 
                background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #0e4b99 100%);
            }
            25% { 
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #0e4b99 75%, #2d1b69 100%);
            }
            50% { 
                background: linear-gradient(135deg, #16213e 0%, #0f3460 25%, #0e4b99 50%, #2d1b69 75%, #3b0764 100%);
            }
            75% { 
                background: linear-gradient(135deg, #0f3460 0%, #0e4b99 25%, #2d1b69 50%, #3b0764 75%, #1a1a2e 100%);
            }
        }

        @keyframes neuraGlow {
            0%, 100% { opacity: 0.3; transform: scale(1) rotate(0deg); }
            50% { opacity: 0.6; transform: scale(1.1) rotate(180deg); }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: #00ffff;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5), 0 0 40px rgba(0, 255, 255, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .panel {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 
                0 20px 40px rgba(0,255,255,0.1), 
                0 0 20px rgba(255,0,255,0.1),
                inset 0 1px 0 rgba(0,255,255,0.2);
            border: 2px solid rgba(0,255,255,0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 25px 50px rgba(0,255,255,0.2), 
                0 0 30px rgba(255,0,255,0.2),
                inset 0 1px 0 rgba(0,255,255,0.4);
            border-color: rgba(0,255,255,0.6);
        }

        .hidden {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #00ffff, #ff00ff);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4), 0 0 20px rgba(255, 0, 255, 0.2);
            position: relative;
            overflow: hidden;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 255, 0.5);
        }

        .btn:hover {
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 0, 255, 0.6), 0 0 30px rgba(0, 255, 255, 0.4);
            border-color: rgba(255, 0, 255, 0.8);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: rgba(255,255,255,0.9);
            color: #667eea;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
        }

        .nav-button:hover, .nav-button.active {
            background: #667eea;
            color: white;
        }

        .card {
            background: linear-gradient(145deg, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.9));
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin: 15px 0;
            box-shadow: 
                0 15px 35px rgba(0,255,255,0.1), 
                inset 0 1px 0 rgba(0,255,255,0.3),
                0 0 20px rgba(255,0,255,0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(0,255,255,0.3);
            position: relative;
            overflow: hidden;
            color: #e0e0e0;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 25px 50px rgba(0,255,255,0.2), 
                inset 0 2px 0 rgba(0,255,255,0.5),
                0 0 30px rgba(255,0,255,0.2);
            border-color: rgba(0,255,255,0.6);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00ffff, #ff00ff, #00ff00, #ffff00, #00ffff);
            background-size: 200% 100%;
            animation: cardGlow 3s linear infinite;
        }

        @keyframes cardGlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .pet-avatar, .hero-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .pet-avatar:hover, .hero-avatar:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 12px 40px rgba(0,0,0,0.3);
        }

        /* Avatares espec√≠ficos para diferentes tipos */
        .avatar-hero {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        .avatar-pet-dog {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
        }

        .avatar-pet-cat {
            background: linear-gradient(135deg, #48dbfb, #0abde3);
        }

        .avatar-pet-bird {
            background: linear-gradient(135deg, #1dd1a1, #10ac84);
        }

        .avatar-pet-reptile {
            background: linear-gradient(135deg, #54a0ff, #2e86de);
        }

        .avatar-pet-other {
            background: linear-gradient(135deg, #a55eea, #8b13d6);
        }

        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Panel Pou simplificado */
        .pou-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .pou-pet {
            text-align: center;
        }

        .pou-avatar {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: linear-gradient(145deg, #667eea, #764ba2);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
            color: white;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 20px 60px rgba(0,255,255,0.4), inset 0 1px 0 rgba(0,255,255,0.3);
            border: 4px solid rgba(0,255,255,0.6);
            animation: petIdle 4s ease-in-out infinite;
        }

        /* Clases espec√≠ficas para el avatar Pou */
        .pou-avatar-dog {
            background-image: url('https://images.unsplash.com/photo-1552053831-71594a27632d?w=400&h=400&fit=crop&crop=face');
        }

        .pou-avatar-cat {
            background-image: url('https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=400&h=400&fit=crop&crop=face');
        }

        .pou-avatar-bird {
            background-image: url('https://images.unsplash.com/photo-1552728089-57bdde30beb3?w=400&h=400&fit=crop&crop=face');
        }

        .pou-avatar-reptile {
            background-image: url('https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=400&fit=crop&crop=face');
        }

        .pou-avatar-other {
            background-image: url('https://images.unsplash.com/photo-1425082661705-1834bfd09dca?w=400&h=400&fit=crop&crop=face');
        }

        /* Imagen real del animal dentro del avatar */
        .real-pet-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 1;
            transition: all 0.3s ease;
        }

        /* Im√°genes espec√≠ficas para cada tipo */
        .real-pet-dog {
            background-image: url('https://images.unsplash.com/photo-1552053831-71594a27632d?w=300&h=300&fit=crop&crop=face');
        }

        .real-pet-cat {
            background-image: url('https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=300&h=300&fit=crop&crop=face');
        }

        .real-pet-bird {
            background-image: url('https://images.unsplash.com/photo-1552728089-57bdde30beb3?w=300&h=300&fit=crop&crop=face');
        }

        .real-pet-reptile {
            background-image: url('https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=300&fit=crop&crop=face');
        }

        .real-pet-other {
            background-image: url('https://images.unsplash.com/photo-1425082661705-1834bfd09dca?w=300&h=300&fit=crop&crop=face');
        }

        /* Animaci√≥n de respiraci√≥n/latido cuando est√° idle */
        @keyframes petIdle {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 20px 60px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 25px 70px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.4);
            }
        }

        .pou-avatar:hover {
            animation: petHover 0.8s ease-in-out infinite;
        }

        @keyframes petHover {
            0%, 100% { 
                transform: scale(1.02) rotate(-1deg);
                box-shadow: 0 30px 80px rgba(255,105,180,0.3), inset 0 2px 0 rgba(255,255,255,0.5);
            }
            50% { 
                transform: scale(1.05) rotate(1deg);
                box-shadow: 0 35px 90px rgba(255,105,180,0.4), inset 0 3px 0 rgba(255,255,255,0.6);
            }
        }

        .pou-avatar::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 400% 400%;
            animation: gradientRotate 4s ease infinite;
            z-index: -1;
        }

        @keyframes gradientRotate {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .pou-avatar.happy {
            background: #28a745;
            animation: bounce 0.5s ease;
        }

        .pou-avatar.sad {
            background: #dc3545;
            animation: shake 0.5s ease;
        }

        .pou-avatar.eating {
            animation: eating 1s ease;
        }

        .pou-avatar.playing {
            animation: spin 1s ease;
        }

        .pou-avatar.walking {
            animation: walking 1s ease;
        }

        .pou-avatar.sleeping {
            background: #6c757d;
            opacity: 0.8;
            animation: sleeping 2s infinite;
        }

        /* Cuerpo de la mascota virtual */
        .virtual-pet-body {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            z-index: 2;
            transition: all 0.3s ease;
            animation: petBodyFloat 3s ease-in-out infinite;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 3px solid rgba(0, 255, 255, 0.6);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        @keyframes petBodyFloat {
            0%, 100% { 
                transform: translate(-50%, -50%) rotate(-2deg) scale(1);
            }
            50% { 
                transform: translate(-50%, -52%) rotate(2deg) scale(1.05);
            }
        }

        /* Tipos espec√≠ficos de mascotas virtuales */
        .virtual-pet-dog {
            background-image: url('https://images.unsplash.com/photo-1552053831-71594a27632d?w=200&h=200&fit=crop&crop=face');
        }

        .virtual-pet-cat {
            background-image: url('https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=200&h=200&fit=crop&crop=face');
        }

        .virtual-pet-bird {
            background-image: url('https://images.unsplash.com/photo-1552728089-57bdde30beb3?w=200&h=200&fit=crop&crop=face');
        }

        .virtual-pet-reptile {
            background-image: url('https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=200&h=200&fit=crop&crop=face');
        }

        .virtual-pet-other {
            background-image: url('https://images.unsplash.com/photo-1425082661705-1834bfd09dca?w=200&h=200&fit=crop&crop=face');
        }

        /* Expresiones faciales */
        .pou-face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            z-index: 3;
        }

        .pou-eyes {
            position: absolute;
            top: 35%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            z-index: 4;
            animation: eyesBlink 4s ease-in-out infinite;
        }

        @keyframes eyesBlink {
            0%, 90%, 100% { 
                transform: translateX(-50%) scaleY(1);
            }
            95% { 
                transform: translateX(-50%) scaleY(0.1);
            }
        }

        .pou-mouth {
            position: absolute;
            bottom: 35%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            z-index: 4;
            animation: mouthWiggle 2s ease-in-out infinite;
        }

        @keyframes mouthWiggle {
            0%, 100% { 
                transform: translateX(-50%) rotate(0deg);
            }
            25% { 
                transform: translateX(-52%) rotate(-1deg);
            }
            75% { 
                transform: translateX(-48%) rotate(1deg);
            }
        }

        /* Efectos de part√≠culas */
        .particle-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 5;
        }

        .ambient-particles {
            position: absolute;
            width: 300px;
            height: 300px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 1;
        }

        .ambient-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0,255,255,0.8), rgba(255,0,255,0.4));
            animation: ambientFloat 8s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(0,255,255,0.6);
        }

        .ambient-particle:nth-child(odd) {
            background: radial-gradient(circle, rgba(255,0,255,0.8), rgba(0,255,255,0.4));
            box-shadow: 0 0 10px rgba(255,0,255,0.6);
        }

        .ambient-particle:nth-child(3n) {
            background: radial-gradient(circle, rgba(0,255,0,0.8), rgba(255,255,0,0.4));
            box-shadow: 0 0 10px rgba(0,255,0,0.6);
        }

        @keyframes ambientFloat {
            0%, 100% {
                transform: translateY(0px) translateX(0px) scale(0.5);
                opacity: 0.3;
            }
            25% {
                transform: translateY(-40px) translateX(20px) scale(0.8);
                opacity: 0.6;
            }
            50% {
                transform: translateY(-20px) translateX(-30px) scale(1);
                opacity: 0.8;
            }
            75% {
                transform: translateY(-60px) translateX(10px) scale(0.7);
                opacity: 0.5;
            }
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: particle-float 1s ease-out forwards;
        }

        .heart-particle {
            color: #e91e63;
            font-size: 1.2rem;
        }

        .food-particle {
            color: #ffc107;
            font-size: 1rem;
        }

        .star-particle {
            color: #ffeb3b;
            font-size: 1rem;
        }

        /* Animaciones */
        @keyframes bounce {
            0%, 20%, 60%, 100% { 
                transform: translateY(0) scale(1) rotate(0deg);
            }
            40% { 
                transform: translateY(-30px) scale(1.1) rotate(-5deg);
            }
            80% { 
                transform: translateY(-15px) scale(1.05) rotate(3deg);
            }
        }

        @keyframes shake {
            0%, 100% { 
                transform: translateX(0) rotate(0deg);
            }
            10%, 30%, 50%, 70%, 90% { 
                transform: translateX(-8px) rotate(-2deg) scale(0.98);
            }
            20%, 40%, 60%, 80% { 
                transform: translateX(8px) rotate(2deg) scale(0.98);
            }
        }

        @keyframes eating {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
            }
            25% { 
                transform: scale(1.15) rotate(-3deg);
            }
            50% { 
                transform: scale(1.2) rotate(0deg);
            }
            75% { 
                transform: scale(1.15) rotate(3deg);
            }
        }

        @keyframes spin {
            0% { 
                transform: rotate(0deg) scale(1);
            }
            25% { 
                transform: rotate(90deg) scale(1.1);
            }
            50% { 
                transform: rotate(180deg) scale(1.2);
            }
            75% { 
                transform: rotate(270deg) scale(1.1);
            }
            100% { 
                transform: rotate(360deg) scale(1);
            }
        }

        @keyframes walking {
            0%, 100% { 
                transform: translateX(0) rotate(0deg) scaleX(1);
            }
            25% { 
                transform: translateX(-15px) rotate(-5deg) scaleX(0.95);
            }
            50% { 
                transform: translateX(0) rotate(0deg) scaleX(1.05);
            }
            75% { 
                transform: translateX(15px) rotate(5deg) scaleX(0.95);
            }
        }

        @keyframes sleeping {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                opacity: 0.8;
            }
            50% { 
                transform: scale(1.03) rotate(1deg);
                opacity: 0.9;
            }
        }

        @keyframes particle-float {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1) rotate(0deg);
            }
            25% {
                opacity: 0.8;
                transform: translate(calc(var(--random-x, 50px) * 0.3), calc(var(--random-y, -50px) * 0.3)) scale(1.2) rotate(90deg);
            }
            50% {
                opacity: 0.6;
                transform: translate(calc(var(--random-x, 50px) * 0.6), calc(var(--random-y, -50px) * 0.6)) scale(0.8) rotate(180deg);
            }
            75% {
                opacity: 0.3;
                transform: translate(calc(var(--random-x, 50px) * 0.8), calc(var(--random-y, -50px) * 0.8)) scale(1.1) rotate(270deg);
            }
            100% {
                opacity: 0;
                transform: translate(var(--random-x, 50px), var(--random-y, -50px)) scale(0) rotate(360deg);
            }
        }

        /* Estados especiales */
        .pou-container.feeding .pou-avatar {
            animation: eating 1s ease;
        }

        .pou-container.playing .pou-avatar {
            animation: spin 1s ease;
        }

        .pou-container.walking .pou-avatar {
            animation: walking 1s ease;
        }

        .pou-stats {
            background: rgba(26, 26, 46, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.1);
            color: #ffffff;
        }

        .pou-stats h5 {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            margin-bottom: 10px;
        }

        .pou-stats span {
            color: #ffffff;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        .stat-bar {
            background: rgba(15, 15, 35, 0.8);
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .stat-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .health-fill {
            background: linear-gradient(45deg, #28a745, #20c997);
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.3);
        }

        .happiness-fill {
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }

        .hunger-fill {
            background: linear-gradient(45deg, #dc3545, #c82333);
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.3);
        }

        .pou-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .action-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
        }

        .action-btn:hover {
            background: #5a6fd8;
        }

        .action-btn.feed {
            background: #28a745;
        }

        .action-btn.play {
            background: #ffc107;
            color: #333;
        }

        .action-btn.walk {
            background: #17a2b8;
        }

        .action-btn.heal {
            background: #dc3545;
        }

        .action-btn.revive {
            background: #6f42c1;
        }

        .action-btn.dress {
            background: #e83e8c;
        }

        .pet-clothing {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            z-index: 2;
        }

        .pet-avatar {
            position: relative;
        }

        .clothing-selector {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .clothing-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .clothing-option {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .clothing-option:hover {
            border-color: #667eea;
            background: #e3f2fd;
        }

        .clothing-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1000;
        }

        .connection-status.online {
            background: #28a745;
        }

        .connection-status.offline {
            background: #dc3545;
        }

        @media (max-width: 768px) {
            .pou-container {
                grid-template-columns: 1fr;
            }
            
            .nav-menu {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Indicador de conexi√≥n -->
    <div id="connection-status" class="connection-status offline">
        <i class="fas fa-wifi"></i> Offline
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> H√©roes y Mascotas</h1>
            <p>¬°Juego con MongoDB - Datos Persistentes!</p>
        </div>

        <!-- Panel de Login -->
        <div class="panel" id="login-panel">
            <h2><i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n</h2>
            <div id="login-status"></div>
            
            <div class="form-group">
                <label for="username">Usuario:</label>
                <input type="text" id="username" placeholder="Tu nombre de usuario">
            </div>
            <div class="form-group">
                <label for="password">Contrase√±a:</label>
                <input type="password" id="password" placeholder="Tu contrase√±a">
            </div>
            <button class="btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n
            </button>
            <button class="btn btn-success" onclick="showRegister()">
                <i class="fas fa-user-plus"></i> Registrarse
            </button>
            <button class="btn" onclick="createSampleData()" style="background: #6f42c1; margin-top: 10px;">
                <i class="fas fa-magic"></i> Crear Datos de Ejemplo
            </button>
        </div>

        <!-- Panel de Registro -->
        <div class="panel hidden" id="register-panel">
            <h2><i class="fas fa-user-plus"></i> Registrarse</h2>
            <div id="register-status"></div>
            
            <div class="form-group">
                <label for="reg-username">Usuario:</label>
                <input type="text" id="reg-username" placeholder="Nombre de usuario">
            </div>
            <div class="form-group">
                <label for="reg-password">Contrase√±a:</label>
                <input type="password" id="reg-password" placeholder="Contrase√±a">
            </div>
            <div class="form-group">
                <label for="reg-name">Nombre del H√©roe:</label>
                <input type="text" id="reg-name" placeholder="Nombre real del h√©roe">
            </div>
            <div class="form-group">
                <label for="reg-alias">Alias:</label>
                <input type="text" id="reg-alias" placeholder="Alias del h√©roe">
            </div>
            <button class="btn btn-success" onclick="register()">
                <i class="fas fa-user-plus"></i> Registrarse
            </button>
            <button class="btn" onclick="showLogin()">
                <i class="fas fa-arrow-left"></i> Volver al Login
            </button>
        </div>

        <!-- Panel Principal del Juego -->
        <div class="panel hidden" id="game-panel">
            <h2><i class="fas fa-gamepad"></i> Panel Principal</h2>
            <div id="game-status"></div>
            
            <!-- Men√∫ de Navegaci√≥n -->
            <div class="nav-menu">
                <button class="nav-button active" onclick="showSection('heroes')">
                    <i class="fas fa-users"></i> H√©roes
                </button>
                <button class="nav-button" onclick="showSection('pets')">
                    <i class="fas fa-paw"></i> Mascotas
                </button>
                <button class="nav-button" onclick="showSection('adoptions')">
                    <i class="fas fa-heart"></i> Adopciones
                </button>
                <button class="nav-button" onclick="showSection('virtual-pets')">
                    <i class="fas fa-robot"></i> Mascotas Virtuales
                </button>
                <button class="nav-button btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                </button>
                <button class="nav-button btn-danger" onclick="resetGame()" style="background: #fd7e14;">
                    <i class="fas fa-trash"></i> Reiniciar Juego
                </button>
            </div>

            <!-- Secci√≥n de H√©roes -->
            <div id="heroes-section">
                <h3><i class="fas fa-users"></i> Gesti√≥n de H√©roes</h3>
                <div id="heroes-status"></div>
                
                <div class="form-group">
                    <label for="hero-name">Nombre:</label>
                    <input type="text" id="hero-name" placeholder="Nombre del h√©roe">
                </div>
                <div class="form-group">
                    <label for="hero-alias">Alias:</label>
                    <input type="text" id="hero-alias" placeholder="Alias del h√©roe">
                </div>
                <div class="form-group">
                    <label for="hero-city">Ciudad:</label>
                    <input type="text" id="hero-city" placeholder="Ciudad del h√©roe">
                </div>
                <div class="form-group">
                    <label for="hero-team">Equipo:</label>
                    <input type="text" id="hero-team" placeholder="Equipo del h√©roe">
                </div>
                <div class="form-group">
                    <label for="hero-powers">Poderes:</label>
                    <input type="text" id="hero-powers" placeholder="Poderes del h√©roe (separados por comas)">
                </div>
                <button class="btn" onclick="createHero()">
                    <i class="fas fa-plus"></i> Crear H√©roe
                </button>
                <button class="btn btn-success" onclick="loadHeroes()">
                    <i class="fas fa-list"></i> Ver Todos
                </button>
                
                <div id="heroes-list"></div>
            </div>

            <!-- Secci√≥n de Mascotas -->
            <div id="pets-section" class="hidden">
                <h3><i class="fas fa-paw"></i> Gesti√≥n de Mascotas</h3>
                <div id="pets-status"></div>
                
                <div class="form-group">
                    <label for="pet-name">Nombre:</label>
                    <input type="text" id="pet-name" placeholder="Nombre de la mascota">
                </div>
                <div class="form-group">
                    <label for="pet-type">Tipo:</label>
                    <select id="pet-type">
                        <option value="">Selecciona un tipo</option>
                        <option value="Perro">Perro</option>
                        <option value="Gato">Gato</option>
                        <option value="Ave">Ave</option>
                        <option value="Reptil">Reptil</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pet-power">Poder:</label>
                    <input type="text" id="pet-power" placeholder="Poder de la mascota">
                </div>
                <button class="btn" onclick="createPet()">
                    <i class="fas fa-plus"></i> Crear Mascota
                </button>
                <button class="btn btn-success" onclick="loadPets()">
                    <i class="fas fa-list"></i> Ver Todas
                </button>
                
                <div id="pets-list"></div>
            </div>

            <!-- Secci√≥n de Adopciones -->
            <div id="adoptions-section" class="hidden">
                <h3><i class="fas fa-heart"></i> Adopciones</h3>
                <div id="adoptions-status"></div>
                
                <div class="form-group">
                    <label for="adopt-pet-id">ID de la Mascota:</label>
                    <input type="number" id="adopt-pet-id" placeholder="ID de la mascota a adoptar">
                </div>
                <button class="btn btn-success" onclick="adoptPet()">
                    <i class="fas fa-heart"></i> Adoptar Mascota
                </button>
                <button class="btn btn-success" onclick="loadMyAdoptions()">
                    <i class="fas fa-list"></i> Ver Mis Adopciones
                </button>
                
                <div id="adoptions-list"></div>
            </div>

            <!-- Secci√≥n de Mascotas Virtuales -->
            <div id="virtual-pets-section" class="hidden">
                <h3><i class="fas fa-robot"></i> Mascotas Virtuales</h3>
                <div id="virtual-pets-status"></div>
                
                <div class="form-group">
                    <label for="virtual-pet-id">ID de la Mascota Adoptada:</label>
                    <input type="number" id="virtual-pet-id" placeholder="ID de la mascota adoptada">
                </div>
                <button class="btn" onclick="createVirtualPet()">
                    <i class="fas fa-plus"></i> Crear Mascota Virtual
                </button>
                <button class="btn btn-success" onclick="loadVirtualPets()">
                    <i class="fas fa-list"></i> Ver Mascotas Virtuales
                </button>
                
                <div id="virtual-pets-list"></div>
            </div>

            <!-- Panel de Mascota Virtual Individual (Estilo Pou) -->
            <div id="pou-panel" class="hidden">
                <h3><i class="fas fa-robot"></i> Mi Mascota Virtual</h3>
                <div id="pou-status"></div>
                
                <div class="pou-container">
                    <!-- Lado izquierdo: Mascota y estad√≠sticas -->
                    <div class="pou-pet">
                        <div class="pou-avatar" id="pou-avatar" onclick="petPet()">
                            <!-- Imagen real del animal como fondo -->
                            <div class="real-pet-image" id="real-pet-image"></div>
                            <div class="pou-eyes" id="pou-eyes">üëÄ</div>
                            <div class="pou-mouth" id="pou-mouth">üòä</div>
                            <div class="particle-effect" id="particle-effect"></div>
                            <!-- Part√≠culas flotantes autom√°ticas -->
                            <div class="ambient-particles" id="ambient-particles"></div>
                        </div>
                        <h4 id="pou-name" style="color: #00ffff; font-weight: bold; text-shadow: 0 0 15px rgba(0, 255, 255, 0.7); margin-bottom: 20px; font-size: 1.5rem;">Cargando...</h4>
                        
                        <div class="pou-stats">
                            <h5><i class="fas fa-heartbeat"></i> Salud</h5>
                            <div class="stat-bar">
                                <div class="stat-fill health-fill" id="health-bar" style="width: 0%"></div>
                            </div>
                            <span id="health-value">0</span>/100
                            
                            <h5><i class="fas fa-smile"></i> Felicidad</h5>
                            <div class="stat-bar">
                                <div class="stat-fill happiness-fill" id="happiness-bar" style="width: 0%"></div>
                            </div>
                            <span id="happiness-value">0</span>/100
                            
                            <h5><i class="fas fa-utensils"></i> Hambre</h5>
                            <div class="stat-bar">
                                <div class="stat-fill hunger-fill" id="hunger-bar" style="width: 0%"></div>
                            </div>
                            <span id="hunger-value">0</span>/100
                            
                            <h5><i class="fas fa-info-circle"></i> Estado</h5>
                            <div id="pet-status" style="color: #00ffff; font-weight: bold; text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);">Cargando...</div>
                        </div>
                    </div>
                    
                    <!-- Lado derecho: Acciones -->
                    <div>
                        <div class="pou-actions">
                            <button class="action-btn feed" onclick="feedPet()">
                                <i class="fas fa-utensils"></i> Alimentar
                            </button>
                            <button class="action-btn play" onclick="playWithPet()">
                                <i class="fas fa-dice"></i> Jugar
                            </button>
                            <button class="action-btn walk" onclick="walkPet()">
                                <i class="fas fa-walking"></i> Pasear
                            </button>
                            <button class="action-btn heal" onclick="healPet()">
                                <i class="fas fa-first-aid"></i> Curar
                            </button>
                            <button class="action-btn revive" onclick="revivePet()">
                                <i class="fas fa-heart"></i> Revivir
                            </button>
                            <button class="action-btn dress" onclick="toggleClothingSelector()">
                                <i class="fas fa-tshirt"></i> Vestir
                            </button>
                        </div>
                        
                        <!-- Selector de ropa -->
                        <div id="clothing-selector" class="clothing-selector hidden">
                            <h5><i class="fas fa-tshirt"></i> Elegir Ropa</h5>
                            <div class="clothing-options">
                                <div class="clothing-option" onclick="dressPet('none')">
                                    <i class="fas fa-times"></i><br>Sin ropa
                                </div>
                                <div class="clothing-option" onclick="dressPet('hat')">
                                    <i class="fas fa-hat-cowboy"></i><br>Sombrero
                                </div>
                                <div class="clothing-option" onclick="dressPet('glasses')">
                                    <i class="fas fa-glasses"></i><br>Lentes
                                </div>
                                <div class="clothing-option" onclick="dressPet('bowtie')">
                                    <i class="fas fa-bowtie"></i><br>Corbata
                                </div>
                                <div class="clothing-option" onclick="dressPet('crown')">
                                    <i class="fas fa-crown"></i><br>Corona
                                </div>
                                <div class="clothing-option" onclick="dressPet('scarf')">
                                    <i class="fas fa-scarf"></i><br>Bufanda
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h5 style="color: #00ffff; text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);"><i class="fas fa-history"></i> √öltima Actividad</h5>
                            <div id="last-activity" style="color: #ffffff; font-weight: bold; text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);">Ninguna actividad realizada</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="backToVirtualPets()">
                    <i class="fas fa-arrow-left"></i> Volver a Mascotas Virtuales
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n h√≠brida: localStorage + MongoDB
        // Detectar entorno y configurar API URL
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const isRailway = window.location.hostname.includes('railway.app') || window.location.hostname.includes('up.railway.app');
        
        let API_BASE_URL;
        if (isLocalhost) {
            API_BASE_URL = 'http://localhost:3001/api';
        } else if (isRailway) {
            // Usar la misma URL base pero con /api
            API_BASE_URL = `${window.location.protocol}//${window.location.host}/api`;
        } else {
            // Para otros casos (GitHub Pages, etc.)
            API_BASE_URL = null;
        }
        let token = localStorage.getItem('token');
        let currentHeroId = null;
        let currentHero = null;
        let currentVirtualPet = null;
        let currentVirtualPetId = null;
        
        // Datos locales (como antes)
        let heroes = [];
        let pets = [];
        let adoptions = [];
        let virtualPets = [];
        let nextHeroId = 1;
        let nextPetId = 1;
        let nextVirtualPetId = 1;

        // Funci√≥n para hacer peticiones a la API (con fallback a localStorage)
        async function apiRequest(endpoint, options = {}) {
            // Si no hay API_BASE_URL (como en GitHub Pages), ir directo a localStorage
            if (!API_BASE_URL) {
                updateConnectionStatus(false);
                throw new Error('Modo offline - usando localStorage');
            }
            
            const url = `${API_BASE_URL}${endpoint}`;
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(token && { 'Authorization': `Bearer ${token}` }),
                    ...options.headers
                },
                ...options
            };

            try {
                const response = await fetch(url, config);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || errorData.message || `HTTP error! status: ${response.status}`);
                }
                
                updateConnectionStatus(true);
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                updateConnectionStatus(false);
                throw error;
            }
        }

        // Funciones de localStorage (como antes)
        function loadSavedData() {
            heroes = JSON.parse(localStorage.getItem('heroes') || '[]');
            pets = JSON.parse(localStorage.getItem('pets') || '[]');
            adoptions = JSON.parse(localStorage.getItem('adoptions') || '[]');
            virtualPets = JSON.parse(localStorage.getItem('virtualPets') || '[]');
            
            if (heroes.length > 0) {
                nextHeroId = Math.max(...heroes.map(h => h.id)) + 1;
            }
            if (pets.length > 0) {
                nextPetId = Math.max(...pets.map(p => p.id)) + 1;
            }
            if (virtualPets.length > 0) {
                nextVirtualPetId = Math.max(...virtualPets.map(v => v.id)) + 1;
            }
        }

        function saveData() {
            localStorage.setItem('heroes', JSON.stringify(heroes));
            localStorage.setItem('pets', JSON.stringify(pets));
            localStorage.setItem('adoptions', JSON.stringify(adoptions));
            localStorage.setItem('virtualPets', JSON.stringify(virtualPets));
        }

        // Funci√≥n para actualizar el estado de conexi√≥n
        function updateConnectionStatus(isOnline) {
            const statusElement = document.getElementById('connection-status');
            if (isOnline) {
                statusElement.className = 'connection-status online';
                statusElement.innerHTML = '<i class="fas fa-wifi"></i> Online';
            } else {
                statusElement.className = 'connection-status offline';
                statusElement.innerHTML = '<i class="fas fa-wifi"></i> Offline';
            }
        }

        // Verificar conexi√≥n al cargar
        async function checkConnection() {
            if (!API_BASE_URL) {
                updateConnectionStatus(false);
                return;
            }
            
            try {
                await fetch(`${API_BASE_URL.replace('/api', '')}/`);
                updateConnectionStatus(true);
            } catch (error) {
                updateConnectionStatus(false);
            }
        }

        // Funciones de navegaci√≥n
        function showLogin() {
            document.getElementById('register-panel').classList.add('hidden');
            document.getElementById('login-panel').classList.remove('hidden');
        }

        function showRegister() {
            document.getElementById('login-panel').classList.add('hidden');
            document.getElementById('register-panel').classList.remove('hidden');
        }

        function showSection(section) {
            ['heroes', 'pets', 'adoptions', 'virtual-pets'].forEach(s => {
                document.getElementById(s + '-section').classList.add('hidden');
            });
            document.getElementById('pou-panel').classList.add('hidden');
            
            document.getElementById(section + '-section').classList.remove('hidden');
            
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function backToVirtualPets() {
            document.getElementById('pou-panel').classList.add('hidden');
            document.getElementById('virtual-pets-section').classList.remove('hidden');
        }

        // Funciones de autenticaci√≥n (h√≠bridas)
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showStatus('login-status', 'Usuario y contrase√±a son obligatorios', 'error');
                return;
            }

            // Intentar con API primero
            try {
                const response = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });

                token = response.token;
                currentHeroId = response.hero.id;
                currentHero = response.hero;
                
                localStorage.setItem('token', token);
                localStorage.setItem('currentHeroId', currentHeroId);
                
                showStatus('login-status', '¬°Inicio de sesi√≥n exitoso! (MongoDB)', 'success');
                
                document.getElementById('login-panel').classList.add('hidden');
                document.getElementById('game-panel').classList.remove('hidden');
                
                updateConnectionStatus(true);
            } catch (error) {
                // Fallback a localStorage
                const hero = heroes.find(h => h.username === username && h.password === password);
                if (hero) {
                    currentHeroId = hero.id;
                    currentHero = hero;
                    localStorage.setItem('currentHeroId', currentHeroId);
                    
                    showStatus('login-status', '¬°Inicio de sesi√≥n exitoso! (Local)', 'success');
                    
                    document.getElementById('login-panel').classList.add('hidden');
                    document.getElementById('game-panel').classList.remove('hidden');
                    
                    updateConnectionStatus(false);
                } else {
                    showStatus('login-status', 'Usuario o contrase√±a incorrectos', 'error');
                }
            }
        }

        async function register() {
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const name = document.getElementById('reg-name').value;
            const alias = document.getElementById('reg-alias').value;

            if (!username || !password || !name || !alias) {
                showStatus('register-status', 'Todos los campos son obligatorios', 'error');
                return;
            }

            if (heroes.find(h => h.username === username)) {
                showStatus('register-status', 'El usuario ya existe', 'error');
                return;
            }

            // Intentar con API primero
            try {
                await apiRequest('/auth/register', {
                    method: 'POST',
                    body: JSON.stringify({ username, password, name, alias })
                });

                showStatus('register-status', '¬°Registro exitoso! (MongoDB) Ahora puedes hacer login.', 'success');
                showLogin();
            } catch (error) {
                // Fallback a localStorage
                const newHero = {
                    id: nextHeroId++,
                    username,
                    password,
                    name,
                    alias,
                    city: '',
                    team: ''
                };

                heroes.push(newHero);
                saveData();
                showStatus('register-status', '¬°Registro exitoso! (Local) Ahora puedes hacer login.', 'success');
                showLogin();
            }
        }

        function logout() {
            token = null;
            currentHeroId = null;
            currentHero = null;
            localStorage.removeItem('token');
            localStorage.removeItem('currentHeroId');
            
            document.getElementById('game-panel').classList.add('hidden');
            document.getElementById('login-panel').classList.remove('hidden');
            
            showStatus('login-status', 'Sesi√≥n cerrada', 'info');
        }

        // Funciones de h√©roes (h√≠bridas)
        async function createHero() {
            const name = document.getElementById('hero-name').value;
            const alias = document.getElementById('hero-alias').value;
            const city = document.getElementById('hero-city').value;
            const team = document.getElementById('hero-team').value;
            const powers = document.getElementById('hero-powers').value.split(',').map(p => p.trim()).filter(p => p);

            if (!name || !alias) {
                showStatus('heroes-status', 'Nombre y alias son obligatorios', 'error');
                return;
            }

            // Intentar con API primero
            try {
                await apiRequest('/heroes', {
                    method: 'POST',
                    body: JSON.stringify({ name, alias, city, team, powers })
                });

                showStatus('heroes-status', '¬°H√©roe creado exitosamente! (MongoDB)', 'success');
                clearHeroForm();
                loadHeroes();
            } catch (error) {
                // Fallback a localStorage
                const newHero = {
                    id: nextHeroId++,
                    name,
                    alias,
                    city,
                    team,
                    powers
                };

                heroes.push(newHero);
                saveData();
                showStatus('heroes-status', '¬°H√©roe creado exitosamente! (Local)', 'success');
                clearHeroForm();
                loadHeroes();
            }
        }

        function getHeroAvatar(hero) {
            const heroAvatars = {
                'Superman': 'ü¶∏‚Äç‚ôÇÔ∏è',
                'Batman': 'ü¶á',
                'Spider-Man': 'üï∑Ô∏è',
                'Wonder Woman': 'üë∏',
                'Iron Man': 'ü§ñ',
                'Hulk': 'üíö',
                'Thor': '‚ö°',
                'Captain America': 'üõ°Ô∏è'
            };
            
            return heroAvatars[hero.alias] || 'ü¶∏';
        }

        async function loadHeroes() {
            try {
                const heroes = await apiRequest('/heroes');
                const heroesList = document.getElementById('heroes-list');
                heroesList.innerHTML = heroes.map(hero => `
                    <div class="card">
                        <div class="hero-avatar avatar-hero">
                            ${getHeroAvatar(hero)}
                        </div>
                        <h3>${hero.name}</h3>
                        <div><strong>Alias:</strong> ${hero.alias}</div>
                        <div><strong>Ciudad:</strong> ${hero.city || 'No especificada'}</div>
                        <div><strong>Equipo:</strong> ${hero.team || 'Sin equipo'}</div>
                        <div><strong>Poderes:</strong> ${hero.powers ? hero.powers.join(', ') : 'Sin poderes'}</div>
                        <div><strong>ID:</strong> ${hero.id}</div>
                    </div>
                `).join('');
            } catch (error) {
                // Fallback a localStorage
                const heroesList = document.getElementById('heroes-list');
                heroesList.innerHTML = heroes.map(hero => `
                    <div class="card">
                        <div class="hero-avatar avatar-hero">
                            ${getHeroAvatar(hero)}
                        </div>
                        <h3>${hero.name}</h3>
                        <div><strong>Alias:</strong> ${hero.alias}</div>
                        <div><strong>Ciudad:</strong> ${hero.city || 'No especificada'}</div>
                        <div><strong>Equipo:</strong> ${hero.team || 'Sin equipo'}</div>
                        <div><strong>Poderes:</strong> ${hero.powers ? hero.powers.join(', ') : 'Sin poderes'}</div>
                        <div><strong>ID:</strong> ${hero.id}</div>
                    </div>
                `).join('');
            }
        }

        function clearHeroForm() {
            document.getElementById('hero-name').value = '';
            document.getElementById('hero-alias').value = '';
            document.getElementById('hero-city').value = '';
            document.getElementById('hero-team').value = '';
            document.getElementById('hero-powers').value = '';
        }

        // Funciones de mascotas
        async function createPet() {
            const name = document.getElementById('pet-name').value;
            const type = document.getElementById('pet-type').value;
            const power = document.getElementById('pet-power').value;

            if (!name || !type) {
                showStatus('pets-status', 'Nombre y tipo son obligatorios', 'error');
                return;
            }

            try {
                await apiRequest('/pets', {
                    method: 'POST',
                    body: JSON.stringify({ name, type, power })
                });

                showStatus('pets-status', '¬°Mascota creada exitosamente!', 'success');
                clearPetForm();
                loadPets();
            } catch (error) {
                showStatus('pets-status', error.message || 'Error al crear mascota', 'error');
            }
        }

        function getPetAvatar(pet) {
            const petAvatars = {
                'Perro': 'üêï',
                'Gato': 'üê±',
                'Ave': 'ü¶ú',
                'Reptil': 'ü¶é',
                'Otro': 'üêæ'
            };
            
            return petAvatars[pet.type] || 'üêæ';
        }

        function getPetAvatarClass(pet) {
            const petClasses = {
                'Perro': 'avatar-pet-dog',
                'Gato': 'avatar-pet-cat',
                'Ave': 'avatar-pet-bird',
                'Reptil': 'avatar-pet-reptile',
                'Otro': 'avatar-pet-other'
            };
            
            return petClasses[pet.type] || 'avatar-pet-other';
        }

        async function loadPets() {
            try {
                const pets = await apiRequest('/pets');
                const petsList = document.getElementById('pets-list');
                petsList.innerHTML = pets.map(pet => `
                    <div class="card">
                        <div class="pet-avatar ${getPetAvatarClass(pet)}">
                            ${getPetAvatar(pet)}
                        </div>
                        <h3>${pet.name}</h3>
                        <div><strong>Tipo:</strong> ${pet.type}</div>
                        <div><strong>Poder:</strong> ${pet.power || 'Sin poder'}</div>
                        <div><strong>ID:</strong> ${pet.id}</div>
                        <div><strong>Estado:</strong> ${pet.adopted ? 'Adoptada' : 'Disponible'}</div>
                    </div>
                `).join('');
            } catch (error) {
                showStatus('pets-status', error.message || 'Error al cargar mascotas', 'error');
            }
        }

        function clearPetForm() {
            document.getElementById('pet-name').value = '';
            document.getElementById('pet-type').value = '';
            document.getElementById('pet-power').value = '';
        }

        // Funciones de adopciones
        async function adoptPet() {
            const petId = parseInt(document.getElementById('adopt-pet-id').value);

            if (!petId) {
                showStatus('adoptions-status', 'Por favor ingresa el ID de la mascota', 'error');
                return;
            }

            try {
                await apiRequest('/adopt', {
                    method: 'POST',
                    body: JSON.stringify({ petId })
                });

                showStatus('adoptions-status', '¬°Mascota adoptada exitosamente!', 'success');
                document.getElementById('adopt-pet-id').value = '';
                loadMyAdoptions();
            } catch (error) {
                showStatus('adoptions-status', error.message || 'Error al adoptar mascota', 'error');
            }
        }

        async function loadMyAdoptions() {
            try {
                const adoptions = await apiRequest('/my-adoptions');
                const adoptionsList = document.getElementById('adoptions-list');
                adoptionsList.innerHTML = adoptions.map(adoption => `
                    <div class="card">
                        <div class="pet-avatar">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h3>${adoption.petName}</h3>
                        <div><strong>Tipo:</strong> ${adoption.petType}</div>
                        <div><strong>Fecha:</strong> ${new Date(adoption.fecha).toLocaleDateString()}</div>
                        <div><strong>ID Mascota:</strong> ${adoption.petId}</div>
                    </div>
                `).join('');
            } catch (error) {
                showStatus('adoptions-status', error.message || 'Error al cargar adopciones', 'error');
            }
        }

        // Funciones de mascotas virtuales
        async function createVirtualPet() {
            const petId = parseInt(document.getElementById('virtual-pet-id').value);

            if (!petId) {
                showStatus('virtual-pets-status', 'Por favor ingresa el ID de la mascota adoptada', 'error');
                return;
            }

            try {
                await apiRequest('/virtual/create', {
                    method: 'POST',
                    body: JSON.stringify({ petId })
                });

                showStatus('virtual-pets-status', '¬°Mascota virtual creada exitosamente!', 'success');
                document.getElementById('virtual-pet-id').value = '';
                loadVirtualPets();
            } catch (error) {
                showStatus('virtual-pets-status', error.message || 'Error al crear mascota virtual', 'error');
            }
        }

        async function loadVirtualPets() {
            try {
                const virtualPets = await apiRequest('/virtual/pets');
                const virtualPetsList = document.getElementById('virtual-pets-list');
                
                if (virtualPets.length === 0) {
                    virtualPetsList.innerHTML = `
                        <div class="card">
                            <div class="pet-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <h3>No tienes mascotas virtuales</h3>
                            <p>Crea una mascota virtual desde una mascota adoptada</p>
                        </div>
                    `;
                } else {
                    virtualPetsList.innerHTML = virtualPets.map(pet => {
                        const originalPet = pets.find(p => p.id === pet.id);
                        const avatar = originalPet ? getPetAvatar(originalPet) : 'üêæ';
                        const avatarClass = originalPet ? getPetAvatarClass(originalPet) : 'avatar-pet-other';
                        
                        return `
                            <div class="card" onclick="openPouPanel(${pet.id})" style="cursor: pointer;">
                                <div class="pet-avatar ${avatarClass}">
                                    ${avatar}
                                </div>
                                <h3>${pet.name}</h3>
                                <div><strong>Salud:</strong> ${pet.salud}/100</div>
                                <div><strong>Felicidad:</strong> ${pet.felicidad}/100</div>
                                <div><strong>Estado:</strong> ${pet.muerta ? 'Muerta' : pet.enferma ? 'Enferma' : 'Sana'}</div>
                                <div><strong>ID:</strong> ${pet.id}</div>
                                <button class="btn btn-success" onclick="event.stopPropagation(); openPouPanel(${pet.id})">
                                    <i class="fas fa-play"></i> Cuidar
                                </button>
                            </div>
                        `;
                    }).join('');
                }
            } catch (error) {
                showStatus('virtual-pets-status', error.message || 'Error al cargar mascotas virtuales', 'error');
            }
        }

        // Funciones del panel Pou
        async function openPouPanel(petId) {
            currentVirtualPetId = petId;
            document.getElementById('virtual-pets-section').classList.add('hidden');
            document.getElementById('pou-panel').classList.remove('hidden');
            await loadPouPet();
        }

        async function loadPouPet() {
            try {
                currentVirtualPet = await apiRequest(`/virtual/pets/${currentVirtualPetId}`);
                updatePouDisplay();
            } catch (error) {
                showStatus('pou-status', error.message || 'Error al cargar mascota virtual', 'error');
            }
        }

        function updatePouDisplay() {
            if (!currentVirtualPet) return;

            const pouName = document.getElementById('pou-name');
            if (pouName) pouName.textContent = currentVirtualPet.name;
            
            const healthBar = document.getElementById('health-bar');
            if (healthBar) healthBar.style.width = `${currentVirtualPet.salud}%`;
            
            const healthValue = document.getElementById('health-value');
            if (healthValue) healthValue.textContent = currentVirtualPet.salud;
            
            const happinessBar = document.getElementById('happiness-bar');
            if (happinessBar) happinessBar.style.width = `${currentVirtualPet.felicidad}%`;
            
            const happinessValue = document.getElementById('happiness-value');
            if (happinessValue) happinessValue.textContent = currentVirtualPet.felicidad;
            
            const hunger = currentVirtualPet.satisfecha ? 20 : 80;
            const hungerBar = document.getElementById('hunger-bar');
            if (hungerBar) hungerBar.style.width = `${hunger}%`;
            
            const hungerValue = document.getElementById('hunger-value');
            if (hungerValue) hungerValue.textContent = hunger;
            
            const status = currentVirtualPet.muerta ? 'Muerta' : currentVirtualPet.enferma ? 'Enferma' : 'Sana';
            const petStatus = document.getElementById('pet-status');
            if (petStatus) petStatus.textContent = status;
            
            // Actualizar apariencia seg√∫n estado
            updatePetAppearance();
            
            // Actualizar ropa
            updatePetClothing();
            
            // Iniciar part√≠culas ambiente
            startAmbientParticles();
        }

        function updatePetAppearance() {
            const avatar = document.getElementById('pou-avatar');
            const petBody = document.getElementById('virtual-pet-body');
            const realPetImage = document.getElementById('real-pet-image');
            const eyes = document.getElementById('pou-eyes');
            const mouth = document.getElementById('pou-mouth');
            
            // Limpiar clases de estado del avatar
            avatar.className = 'pou-avatar';
            
            // Determinar qu√© mascota mostrar basado en el tipo original
            const originalPet = pets.find(p => p.id === currentVirtualPet.id);
            if (originalPet) {
                // Limpiar clases anteriores
                if (petBody) petBody.className = 'virtual-pet-body';
                if (realPetImage) realPetImage.className = 'real-pet-image';
                
                // Agregar clase espec√≠fica del tipo a la imagen real
                const realPetTypeClass = {
                    'Perro': 'real-pet-dog',
                    'Gato': 'real-pet-cat',
                    'Ave': 'real-pet-bird',
                    'Reptil': 'real-pet-reptile',
                    'Otro': 'real-pet-other'
                };
                
                // Agregar clase espec√≠fica del tipo al avatar grande
                const avatarTypeClass = {
                    'Perro': 'pou-avatar-dog',
                    'Gato': 'pou-avatar-cat',
                    'Ave': 'pou-avatar-bird',
                    'Reptil': 'pou-avatar-reptile',
                    'Otro': 'pou-avatar-other'
                };
                
                const realPetClass = realPetTypeClass[originalPet.type] || 'real-pet-other';
                const avatarClass = avatarTypeClass[originalPet.type] || 'pou-avatar-other';
                
                if (realPetImage) realPetImage.classList.add(realPetClass);
                avatar.classList.add(avatarClass);
                
                // Limpiar texto del emoji del cuerpo peque√±o si existe
                if (petBody) petBody.textContent = '';
            }
            
            if (currentVirtualPet.muerta) {
                if (avatar) avatar.style.filter = 'grayscale(100%)';
                if (avatar) avatar.classList.add('sleeping');
                if (eyes) eyes.textContent = '‚úñÔ∏è‚úñÔ∏è';
                if (mouth) mouth.textContent = 'üòµ';
                if (petBody) petBody.style.opacity = '0.5';
                if (realPetImage) realPetImage.style.opacity = '0.5';
            } else if (currentVirtualPet.enferma) {
                if (avatar) avatar.style.filter = 'sepia(50%)';
                if (avatar) avatar.style.background = 'linear-gradient(145deg, #dc3545, #c82333)';
                if (eyes) eyes.textContent = 'üò∑üò∑';
                if (mouth) mouth.textContent = 'ü§í';
                if (petBody) petBody.style.opacity = '0.8';
                if (realPetImage) realPetImage.style.opacity = '0.8';
            } else {
                if (avatar) avatar.style.filter = 'none';
                if (petBody) petBody.style.opacity = '1';
                if (realPetImage) realPetImage.style.opacity = '1';
                
                // Expresiones seg√∫n estad√≠sticas
                if (currentVirtualPet.felicidad >= 80) {
                    if (avatar) avatar.style.background = 'linear-gradient(145deg, #28a745, #20c997)';
                    if (eyes) eyes.textContent = 'üòäüòä';
                    if (mouth) mouth.textContent = 'üòÑ';
                } else if (currentVirtualPet.felicidad >= 50) {
                    if (avatar) avatar.style.background = 'linear-gradient(145deg, #667eea, #764ba2)';
                    if (eyes) eyes.textContent = 'üëÄüëÄ';
                    if (mouth) mouth.textContent = 'üòä';
                } else if (currentVirtualPet.felicidad >= 20) {
                    if (avatar) avatar.style.background = 'linear-gradient(145deg, #ffc107, #fd7e14)';
                    if (eyes) eyes.textContent = 'üòêüòê';
                    if (mouth) mouth.textContent = 'üòï';
                } else {
                    if (avatar) avatar.style.background = 'linear-gradient(145deg, #dc3545, #c82333)';
                    if (eyes) eyes.textContent = 'üò¢üò¢';
                    if (mouth) mouth.textContent = 'üò≠';
                }
                
                // Estado de hambre
                if (!currentVirtualPet.satisfecha) {
                    if (mouth) mouth.textContent = 'üçΩÔ∏è';
                }
                
                // Estado de salud baja
                if (currentVirtualPet.salud < 30) {
                    if (eyes) eyes.textContent = 'üò¥üò¥';
                }
            }
        }

        function updatePetClothing() {
            const avatar = document.getElementById('pou-avatar');
            if (!avatar) return; // Verificar que el avatar existe
            
            const existingClothing = avatar.querySelector('.pet-clothing');
            if (existingClothing) {
                existingClothing.remove();
            }
            
            if (currentVirtualPet && currentVirtualPet.ropa && currentVirtualPet.ropa !== 'none') {
                const clothingDiv = document.createElement('div');
                clothingDiv.className = 'pet-clothing';
                
                const clothingIcons = {
                    'hat': 'fas fa-hat-cowboy',
                    'glasses': 'fas fa-glasses',
                    'bowtie': 'fas fa-bowtie',
                    'crown': 'fas fa-crown',
                    'scarf': 'fas fa-scarf'
                };
                
                const iconClass = clothingIcons[currentVirtualPet.ropa] || 'fas fa-tshirt';
                clothingDiv.innerHTML = `<i class="${iconClass}"></i>`;
                avatar.appendChild(clothingDiv);
            }
        }

        function toggleClothingSelector() {
            const selector = document.getElementById('clothing-selector');
            if (!selector) return; // Verificar que el selector existe
            
            selector.classList.toggle('hidden');
            
            // Actualizar selecci√≥n actual
            const options = selector.querySelectorAll('.clothing-option');
            options.forEach(option => {
                option.classList.remove('selected');
                const onclickAttr = option.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/'([^']+)'/);
                    if (match) {
                        const clothingType = match[1];
                        if (currentVirtualPet && currentVirtualPet.ropa === clothingType) {
                            option.classList.add('selected');
                        }
                    }
                }
            });
        }

        async function dressPet(clothingType) {
            if (!currentVirtualPet) return;
            
            // Animaci√≥n de vestirse
            playAnimation('dressing');
            createParticleEffect('star');
            playPetSound('dress'); // Sonido de vestir
            
            try {
                const updatedPet = await apiRequest(`/virtual/pets/${currentVirtualPetId}/dress`, {
                    method: 'POST',
                    body: JSON.stringify({ ropa: clothingType })
                });
                
                currentVirtualPet = updatedPet;
                updatePouDisplay();
                document.getElementById('last-activity').textContent = `¬°Mascota vestida con ${clothingType}!`;
                showStatus('pou-status', `¬°Mascota vestida con ${clothingType}!`, 'success');
                toggleClothingSelector();
            } catch (error) {
                // Fallback a localStorage
                currentVirtualPet.ropa = clothingType;
                saveData();
                updatePouDisplay();
                document.getElementById('last-activity').textContent = `¬°Mascota vestida con ${clothingType}!`;
                showStatus('pou-status', `¬°Mascota vestida con ${clothingType}! (Local)`, 'success');
                toggleClothingSelector();
            }
        }

        // Funci√≥n para crear efectos de part√≠culas
        function createParticleEffect(type) {
            const particleContainer = document.getElementById('particle-effect');
            
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = `particle ${type}-particle`;
                
                // Iconos seg√∫n el tipo de part√≠cula
                const icons = {
                    heart: 'üíñ',
                    food: 'üçé',
                    star: '‚≠ê',
                    healing: '‚ú®',
                    play: 'üéÆ'
                };
                
                particle.textContent = icons[type] || '‚ú®';
                
                // Posici√≥n y direcci√≥n aleatoria
                const randomX = (Math.random() - 0.5) * 100;
                const randomY = -(Math.random() * 80 + 20);
                particle.style.setProperty('--random-x', `${randomX}px`);
                particle.style.setProperty('--random-y', `${randomY}px`);
                
                particleContainer.appendChild(particle);
                
                // Remover part√≠cula despu√©s de la animaci√≥n
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 1000);
            }
        }

        // Funci√≥n para reproducir animaciones
        function playAnimation(animationType) {
            const avatar = document.getElementById('pou-avatar');
            const container = document.querySelector('.pou-container');
            
            // Verificar que los elementos existen
            if (!avatar || !container) return;
            
            // Limpiar animaciones previas
            avatar.classList.remove('happy', 'sad', 'eating', 'playing', 'walking');
            container.classList.remove('feeding', 'playing', 'walking');
            
            // Aplicar nueva animaci√≥n
            switch(animationType) {
                case 'eating':
                    avatar.classList.add('eating');
                    container.classList.add('feeding');
                    break;
                case 'playing':
                    avatar.classList.add('playing');
                    container.classList.add('playing');
                    break;
                case 'walking':
                    avatar.classList.add('walking');
                    container.classList.add('walking');
                    break;
                case 'happy':
                    avatar.classList.add('happy');
                    break;
                case 'sad':
                    avatar.classList.add('sad');
                    break;
                case 'dressing':
                    avatar.classList.add('playing');
                    break;
            }
            
            // Remover animaci√≥n despu√©s de completarla
            setTimeout(() => {
                avatar.classList.remove('happy', 'sad', 'eating', 'playing', 'walking');
                container.classList.remove('feeding', 'playing', 'walking');
            }, 1500);
        }

        // Funci√≥n para reproducir sonidos
        function playPetSound(action) {
            try {
                // Crear un contexto de audio
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                let frequency = 440; // Frecuencia base
                let duration = 0.3; // Duraci√≥n corta
                let type = 'sine'; // Tipo de onda
                
                // Configurar diferentes sonidos seg√∫n la acci√≥n
                switch(action) {
                    case 'eat':
                        // Sonido de masticar (graves)
                        frequency = 200;
                        duration = 0.5;
                        type = 'sawtooth';
                        break;
                    case 'play':
                        // Sonido gamer (agudo y divertido)
                        frequency = 800;
                        duration = 0.4;
                        type = 'square';
                        break;
                    case 'walk':
                        // Sonido de pasos (medio)
                        frequency = 350;
                        duration = 0.6;
                        type = 'triangle';
                        break;
                    case 'heal':
                        // Sonido m√°gico de curaci√≥n
                        frequency = 600;
                        duration = 0.7;
                        type = 'sine';
                        break;
                    case 'revive':
                        // Sonido √©pico de revivir
                        frequency = 440;
                        duration = 1.0;
                        type = 'square';
                        break;
                    case 'pet':
                        // Sonido suave de caricia
                        frequency = 500;
                        duration = 0.3;
                        type = 'sine';
                        break;
                    case 'dress':
                        // Sonido de vestir
                        frequency = 700;
                        duration = 0.4;
                        type = 'triangle';
                        break;
                }
                
                // Crear oscilador
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;
                
                // Envelope para hacer el sonido m√°s suave
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
                
                // Para sonidos especiales, agregar efectos
                if (action === 'play') {
                    // Segundo tono para efecto gamer
                    setTimeout(() => {
                        const osc2 = audioContext.createOscillator();
                        const gain2 = audioContext.createGain();
                        osc2.connect(gain2);
                        gain2.connect(audioContext.destination);
                        osc2.frequency.setValueAtTime(frequency * 1.5, audioContext.currentTime);
                        osc2.type = 'square';
                        gain2.gain.setValueAtTime(0, audioContext.currentTime);
                        gain2.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.01);
                        gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        osc2.start(audioContext.currentTime);
                        osc2.stop(audioContext.currentTime + 0.2);
                    }, 100);
                }
                
                if (action === 'revive') {
                    // Secuencia ascendente para revivir
                    const frequencies = [440, 550, 660, 880];
                    frequencies.forEach((freq, index) => {
                        setTimeout(() => {
                            const osc = audioContext.createOscillator();
                            const gain = audioContext.createGain();
                            osc.connect(gain);
                            gain.connect(audioContext.destination);
                            osc.frequency.setValueAtTime(freq, audioContext.currentTime);
                            osc.type = 'sine';
                            gain.gain.setValueAtTime(0, audioContext.currentTime);
                            gain.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.01);
                            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                            osc.start(audioContext.currentTime);
                            osc.stop(audioContext.currentTime + 0.15);
                        }, index * 100);
                    });
                }
                
            } catch (error) {
                console.log('Audio no disponible:', error);
            }
        }

        // Funci√≥n para crear part√≠culas ambiente autom√°ticas
        function startAmbientParticles() {
            const ambientContainer = document.getElementById('ambient-particles');
            if (!ambientContainer) return;
            
            // Limpiar part√≠culas existentes
            ambientContainer.innerHTML = '';
            
            // Solo crear part√≠culas si la mascota est√° viva y feliz
            if (!currentVirtualPet || currentVirtualPet.muerta || currentVirtualPet.felicidad < 30) return;
            
            const particleCount = Math.min(6, Math.floor(currentVirtualPet.felicidad / 20));
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'ambient-particle';
                
                // Posici√≥n aleatoria alrededor de la mascota
                const angle = (i / particleCount) * 360 + Math.random() * 60;
                const radius = 80 + Math.random() * 40;
                const x = Math.cos(angle * Math.PI / 180) * radius;
                const y = Math.sin(angle * Math.PI / 180) * radius;
                
                particle.style.left = `${150 + x}px`;
                particle.style.top = `${150 + y}px`;
                particle.style.animationDelay = `${Math.random() * 8}s`;
                
                ambientContainer.appendChild(particle);
            }
        }

        // Funci√≥n para acariciar a la mascota
        function petPet() {
            if (!currentVirtualPet || currentVirtualPet.muerta) return;
            
            playAnimation('happy');
            createParticleEffect('heart');
            playPetSound('pet'); // Agregar sonido de caricia
            
            // Aumentar felicidad ligeramente
            if (currentVirtualPet.felicidad < 100) {
                currentVirtualPet.felicidad = Math.min(100, currentVirtualPet.felicidad + 5);
                saveData();
                updatePouDisplay();
                document.getElementById('last-activity').textContent = '¬°Acariciaste a tu mascota!';
            }
        }

        // Funciones de actividades Pou
        async function feedPet() {
            if (!currentVirtualPet) return;
            
            // Animaci√≥n de comer
            playAnimation('eating');
            createParticleEffect('food');
            playPetSound('eat'); // Sonido de comer
            
            try {
                const updatedPet = await apiRequest(`/virtual/pets/${currentVirtualPetId}/feed`, {
                    method: 'POST'
                });
                
                currentVirtualPet = updatedPet;
                updatePouDisplay();
                document.getElementById('last-activity').textContent = '¬°Mascota alimentada!';
                
                // Animaci√≥n seg√∫n resultado
                if (updatedPet.muerta) {
                    playAnimation('sad');
                    showStatus('pou-status', '¬°La mascota muri√≥ por sobrealimentaci√≥n!', 'error');
                } else if (updatedPet.enferma) {
                    playAnimation('sad');
                    showStatus('pou-status', '¬°La mascota se enferm√≥ por comer demasiado!', 'error');
                } else {
                    playAnimation('happy');
                    showStatus('pou-status', '¬°Mascota alimentada! Se ve m√°s feliz.', 'success');
                }
            } catch (error) {
                playAnimation('sad');
                showStatus('pou-status', error.message || 'Error al alimentar mascota', 'error');
            }
        }

        async function playWithPet() {
            if (!currentVirtualPet) return;
            
            // Animaci√≥n de jugar
            playAnimation('playing');
            createParticleEffect('play');
            playPetSound('play'); // Sonido gamer de jugar
            
            try {
                const updatedPet = await apiRequest(`/virtual/pets/${currentVirtualPetId}/play`, {
                    method: 'POST'
                });
                
                currentVirtualPet = updatedPet;
                updatePouDisplay();
                document.getElementById('last-activity').textContent = '¬°Jugaste con tu mascota!';
                playAnimation('happy');
                showStatus('pou-status', '¬°Jugaste con tu mascota!', 'success');
            } catch (error) {
                playAnimation('sad');
                showStatus('pou-status', error.message || 'Error al jugar con mascota', 'error');
            }
        }

        async function walkPet() {
            if (!currentVirtualPet) return;
            
            // Animaci√≥n de caminar
            playAnimation('walking');
            createParticleEffect('star');
            playPetSound('walk'); // Sonido de caminar
            
            try {
                const updatedPet = await apiRequest(`/virtual/pets/${currentVirtualPetId}/walk`, {
                    method: 'POST'
                });
                
                currentVirtualPet = updatedPet;
                updatePouDisplay();
                document.getElementById('last-activity').textContent = '¬°Paseaste con tu mascota!';
                playAnimation('happy');
                showStatus('pou-status', '¬°Paseaste con tu mascota!', 'success');
            } catch (error) {
                playAnimation('sad');
                showStatus('pou-status', error.message || 'Error al pasear mascota', 'error');
            }
        }

        async function healPet() {
            if (!currentVirtualPet) return;
            
            // Animaci√≥n de curar
            createParticleEffect('healing');
            playPetSound('heal'); // Sonido m√°gico de curaci√≥n
            
            try {
                const updatedPet = await apiRequest(`/virtual/pets/${currentVirtualPetId}/heal`, {
                    method: 'POST'
                });
                
                currentVirtualPet = updatedPet;
                updatePouDisplay();
                document.getElementById('last-activity').textContent = '¬°Mascota curada!';
                playAnimation('happy');
                showStatus('pou-status', '¬°Mascota curada!', 'success');
            } catch (error) {
                playAnimation('sad');
                showStatus('pou-status', error.message || 'Error al curar mascota', 'error');
            }
        }

        async function revivePet() {
            if (!currentVirtualPet) return;
            
            // Animaci√≥n de revivir
            createParticleEffect('healing');
            createParticleEffect('star');
            playPetSound('revive'); // Sonido √©pico de revivir
            
            try {
                const updatedPet = await apiRequest(`/virtual/pets/${currentVirtualPetId}/revive`, {
                    method: 'POST'
                });
                
                currentVirtualPet = updatedPet;
                updatePouDisplay();
                document.getElementById('last-activity').textContent = '¬°Mascota revivida!';
                playAnimation('happy');
                showStatus('pou-status', '¬°Mascota revivida!', 'success');
            } catch (error) {
                playAnimation('sad');
                showStatus('pou-status', error.message || 'Error al revivir mascota', 'error');
            }
        }

        // Funci√≥n para crear datos de ejemplo (h√≠brida)
        async function createSampleData() {
            try {
                await apiRequest('/heroes/sample-data', {
                    method: 'POST'
                });
                
                showStatus('login-status', '¬°Datos de ejemplo creados! (MongoDB) Ahora puedes hacer login con: superman/1234, batman/1234, spiderman/1234', 'success');
                
                // Limpiar campos
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            } catch (error) {
                // Fallback a localStorage
                const sampleHeroes = [
                    {
                        id: 1,
                        username: 'superman',
                        password: '1234',
                        name: 'Clark Kent',
                        alias: 'Superman',
                        city: 'Metr√≥polis',
                        team: 'Justice League'
                    },
                    {
                        id: 2,
                        username: 'batman',
                        password: '1234',
                        name: 'Bruce Wayne',
                        alias: 'Batman',
                        city: 'Gotham',
                        team: 'Justice League'
                    },
                    {
                        id: 3,
                        username: 'spiderman',
                        password: '1234',
                        name: 'Peter Parker',
                        alias: 'Spider-Man',
                        city: 'Nueva York',
                        team: 'Avengers'
                    }
                ];

                const samplePets = [
                    {
                        id: 1,
                        name: 'Krypto',
                        type: 'Perro',
                        power: 'Super fuerza y vuelo',
                        adopted: false,
                        ownerId: null
                    },
                    {
                        id: 2,
                        name: 'Ace',
                        type: 'Perro',
                        power: 'Detective canino',
                        adopted: false,
                        ownerId: null
                    },
                    {
                        id: 3,
                        name: 'Lucky',
                        type: 'Gato',
                        power: 'Suerte felina',
                        adopted: false,
                        ownerId: null
                    },
                    {
                        id: 4,
                        name: 'Tweety',
                        type: 'Ave',
                        power: 'Canto m√°gico',
                        adopted: false,
                        ownerId: null
                    }
                ];

                heroes = sampleHeroes;
                pets = samplePets;
                nextHeroId = 4;
                nextPetId = 5;
                saveData();
                
                showStatus('login-status', '¬°Datos de ejemplo creados! (Local) Ahora puedes hacer login con: superman/1234, batman/1234, spiderman/1234', 'success');
                
                // Limpiar campos
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }

        // Funci√≥n auxiliar para mostrar estados
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<div class="status ${type}">${message}</div>`;
                setTimeout(() => {
                    if (element) {
                        element.innerHTML = '';
                    }
                }, 5000);
            }
        }

        // Funci√≥n para reiniciar el juego
        async function resetGame() {
            if (confirm('¬øEst√°s seguro de que quieres reiniciar el juego? Se perder√°n todos los datos.')) {
                try {
                    await apiRequest('/reset', {
                        method: 'POST'
                    });
                    
                    localStorage.clear();
                    location.reload();
                } catch (error) {
                    showStatus('game-status', error.message || 'Error al reiniciar juego', 'error');
                }
            }
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedData();
            checkConnection();
            
            // Verificar si hay un token guardado
            const savedToken = localStorage.getItem('token');
            const savedHeroId = localStorage.getItem('currentHeroId');
            
            if (savedToken && savedHeroId) {
                token = savedToken;
                currentHeroId = parseInt(savedHeroId);
                
                // Verificar si el token sigue siendo v√°lido
                apiRequest('/auth/verify')
                    .then(response => {
                        currentHero = response.hero;
                        document.getElementById('login-panel').classList.add('hidden');
                        document.getElementById('game-panel').classList.remove('hidden');
                        updateConnectionStatus(true);
                    })
                    .catch(() => {
                        // Token inv√°lido, verificar si existe en localStorage
                        const hero = heroes.find(h => h.id === currentHeroId);
                        if (hero) {
                            currentHero = hero;
                            document.getElementById('login-panel').classList.add('hidden');
                            document.getElementById('game-panel').classList.remove('hidden');
                            updateConnectionStatus(false);
                        } else {
                            localStorage.removeItem('token');
                            localStorage.removeItem('currentHeroId');
                            updateConnectionStatus(false);
                        }
                    });
            }
        });
    </script>
</body>
</html> 